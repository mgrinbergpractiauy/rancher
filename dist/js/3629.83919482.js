"use strict";(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[3629],{63629:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var o=r(20641);const i=["aria-label"],s={class:"text-center mt-50"},n={key:0},u={key:1},a={key:2};function l(e,t,r,l,c,h){return(0,o.uX)(),(0,o.CE)("main",{class:"main-layout","aria-label":e.t("layouts.verify")},[(0,o.Lk)("h1",s,[c.testing?((0,o.uX)(),(0,o.CE)("span",n,"\n        Testing Configuration…\n      ")):c.isSlo?((0,o.uX)(),(0,o.CE)("span",u,"\n        Logging Out…\n      ")):((0,o.uX)(),(0,o.CE)("span",a,"\n        Logging In…\n      "))])],8,i)}var c=r(46405),h=r(6826),g=r(91709),p=r(51229),d=r(82943),$=r(14586),w=r(96763);const f=["ping","adfs","keycloak","okta","shibboleth"],y=["github","googleoauth","azuread"];function k(e,t){try{if(window.opener)window.opener.window.onAuthTest(e,t);else{const r=new BroadcastChannel($.X8),o={err:e,code:t};r.postMessage(JSON.stringify(o)),r.close()}setTimeout(()=>{window.close()},250)}catch(r){w.error("Error replying to authentication verification",r),window.close()}}function v(e){const{query:t}=e,r=(0,h.get)(t,"config");return f.includes(r)}const E={async fetch(){const e=this.$route.query[c.Wt],t=this.$route.query[c.Mg],{error:r,error_description:o,errorCode:i,errorMsg:s}=this.$route.query;if(r||o||i||s){let e=o||r||i;if(this.isSlo){w.error("Failed to log out of auth provider",r,o,i,s);let e=this.$store.getters["i18n/withFallback"]("logout.specificError.unknown");return i&&(e=this.$store.getters["i18n/withFallback"](`logout.specificError.${i}`,null,e)),void this.$router.replace(`/auth/login?${c.kM}&err=${escape(e)}`)}return s&&(e=this.$store.getters["i18n/withFallback"](`login.serverError.${s}`,null,s)),void this.$router.replace(`/auth/login?err=${escape(e)}`)}if(this.isSlo)return void this.$store.dispatch("auth/uiLogout");let n;try{n=JSON.parse((0,g.u)(t))}catch(h){if(v(this.$route))return;const e=this.$store.getters["i18n/t"]("login.error");return w.error("Failed to parse nonce",t,h),void this.$router.replace(`/auth/login?err=${escape(e)}`)}const{test:u,provider:a,nonce:l}=n;if(!u)try{const t=await this.$store.dispatch("auth/verifyOAuth",{code:e,nonce:l,provider:a});if(200===t._status){const e=this.$route.query[c.MW]||"/";await(0,p.A)({app:this.$store.app,store:this.$store,$plugin:this.$store.$plugin}),this.$router.replace(e)}else this.$router.replace(`/auth/login?err=${escape(t)}`)}catch(h){let e=h;y.includes(a)&&h===d.LOGIN_ERRORS.CLIENT_UNAUTHORIZED&&(e=d.LOGIN_ERRORS.USER_UNAUTHORIZED),this.$router.replace(`/auth/login?err=${escape(e)}`)}},data(){return{testing:null,isSlo:null}},created(){const e=this.$route.query[c.Mg]||"";let t={};try{t=JSON.parse((0,g.u)(e))}catch{}const{test:r}=t;this.testing=r,this.isSlo=this.$route.query[c.kM]===c.Qp},mounted(){if(this.testing)try{const{error:e,error_description:t,[c.Wt]:r,errorMsg:o}=this.$route.query;let i=t||e||(r?null:"No code supplied by auth provider");o&&(i=this.$store.getters["i18n/withFallback"](`login.serverError.${o}`,null,o)),k(i,r)}catch(e){window.close()}else window.opener&&v(this.$route)&&(window.opener.window.onAuthTest?k(null,null):k({err:"failure"}))}};var b=r(66262);const O=(0,b.A)(E,[["render",l]]),S=O}}]);
//# sourceMappingURL=3629.83919482.js.map