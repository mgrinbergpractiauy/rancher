(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[8833],{18833:(e,t,o)=>{"use strict";o.d(t,{A:()=>W});var s=o(20641),r=o(90033);const n={class:"text-default-text"},a={class:"mb-10"},i={key:2,class:"mt-10"},m={class:"confirm-text"},c={class:"text-warning mb-10 mt-10"},l={class:"text-error mb-10 mt-10"},h={key:0,class:"text-info mt-20"},p={key:1},d={key:0,class:"text-warning mb-10 mt-10"},v={key:1,class:"text-error mb-10 mt-10"};function u(e,t,o,u,R,f){const g=(0,s.g2)("LabeledInput"),y=(0,s.g2)("Checkbox"),C=(0,s.g2)("AsyncButton"),b=(0,s.g2)("Card"),k=(0,s.g2)("app-modal"),w=(0,s.gN)("clean-html"),T=(0,s.gN)("focus");return R.showModal?((0,s.uX)(),(0,s.Wv)(k,{key:0,"custom-class":"remove-modal",name:"promptRemove",width:400,height:"auto",styles:"max-height: 100vh;","trigger-focus-trap":!0,onClose:f.close},{default:(0,s.k6)(()=>[(0,s.bF)(b,{class:"prompt-remove","show-highlight-border":!1},{title:(0,s.k6)(()=>[(0,s.Lk)("h4",n,(0,r.v_)(e.t("promptRemove.title")),1)]),body:(0,s.k6)(()=>[(0,s.Lk)("div",a,[R.hasCustomRemove?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,r.v_)(e.t("promptRemove.attemptingToRemove",{type:f.type}))+" ",1),(0,s.bo)((0,s.Lk)("span",null,null,512),[[w,f.resourceNames(f.names,null,e.t)]])],64)),t[5]||(t[5]=(0,s.eW)()),R.hasCustomRemove?((0,s.uX)(),(0,s.Wv)((0,s.$y)(R.removeComponent),(0,s.v6)({key:1,ref:"customPrompt",value:e.toRemove,"onUpdate:value":t[0]||(t[0]=t=>e.toRemove=t)},e.$data,{close:f.close,"needs-confirm":f.needsConfirm,value:e.toRemove,names:f.names,type:f.type,"done-location":f.doneLocation,onErrors:t[1]||(t[1]=e=>R.error=e),onDone:f.done}),null,16,["value","close","needs-confirm","names","type","done-location","onDone"])):(0,s.Q3)("",!0),t[6]||(t[6]=(0,s.eW)()),f.needsConfirm?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.bo)((0,s.Lk)("span",m,null,512),[[w,e.t("promptRemove.confirmName",{nameToMatch:f.escapeHtml(f.nameToMatch)},!0)]])])):(0,s.Q3)("",!0)]),t[10]||(t[10]=(0,s.eW)()),f.needsConfirm?(0,s.bo)(((0,s.uX)(),(0,s.Wv)(g,{key:0,id:"confirm",value:R.confirmName,"onUpdate:value":t[2]||(t[2]=e=>R.confirmName=e),"data-testid":o.componentTestid+"-input",type:"text","aria-label":e.t("promptRemove.confirmName",{nameToMatch:f.escapeHtml(f.nameToMatch)})},{default:(0,s.k6)(()=>[(0,s.Lk)("div",c,(0,r.v_)(R.warning),1),t[7]||(t[7]=(0,s.eW)()),(0,s.Lk)("div",l,(0,r.v_)(R.error),1),t[8]||(t[8]=(0,s.eW)()),f.needsConfirm?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",h,(0,r.v_)(f.protip),1))]),_:1,__:[7,8]},8,["value","data-testid","aria-label"])),[[T]]):R.hasCustomRemove?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",p,[R.warning?((0,s.uX)(),(0,s.CE)("div",d,(0,r.v_)(R.warning),1)):(0,s.Q3)("",!0),t[9]||(t[9]=(0,s.eW)()),R.error?((0,s.uX)(),(0,s.CE)("div",v,(0,r.v_)(R.error),1)):(0,s.Q3)("",!0)])),t[11]||(t[11]=(0,s.eW)()),R.chartsToRemoveIsApp?((0,s.uX)(),(0,s.Wv)(y,{key:2,value:R.chartsDeleteCrd,"onUpdate:value":[t[3]||(t[3]=e=>R.chartsDeleteCrd=e),f.chartAddCrdToRemove],"label-key":"promptRemoveApp.removeCrd",class:"mt-10 type"},null,8,["value","onUpdate:value"])):(0,s.Q3)("",!0)]),actions:(0,s.k6)(()=>[(0,s.Lk)("button",{class:"btn role-secondary",onClick:t[4]||(t[4]=(...e)=>f.close&&f.close(...e))},(0,r.v_)(e.t("generic.cancel")),1),t[12]||(t[12]=(0,s.eW)()),t[13]||(t[13]=(0,s.Lk)("div",{class:"spacer"},null,-1)),t[14]||(t[14]=(0,s.eW)()),(0,s.bF)(C,{mode:"delete",class:"btn bg-error ml-10",disabled:f.deleteDisabled,"data-testid":o.componentTestid+"-confirm-button",onClick:f.remove},null,8,["disabled","data-testid","onClick"])]),_:1,__:[15,16]})]),_:1},8,["onClose"])):(0,s.Q3)("",!0)}var R=o(50953),f=o(66278),g=o(6826),y=o(72140),C=o(40949),b=o(35800),k=o(62606),w=o(65843),T=o(72268),D=o(96676),L=o(55823),x=o(16372),M=o(76365);const _={name:"PromptRemove",components:{Card:C.Z,Checkbox:b.S,AsyncButton:T.A,LabeledInput:x.o,AppModal:M.h},props:{componentTestid:{type:String,default:"prompt-remove"}},data(){const{resource:e}=this.$route.params;return{hasCustomRemove:!1,randomPosition:Math.random(),confirmName:"",error:"",warning:"",preventDelete:!1,removeComponent:(0,R.IJ)(this.$store.getters["type-map/importCustomPromptRemove"](e)),chartsToRemoveIsApp:!1,chartsDeleteCrd:!1,showModal:!1,cachedDoneLocation:null}},computed:{names(){return this.toRemove.map(e=>e.nameDisplay)},nameToMatchPosition(){const e=Math.min(5,this.names.length),t=Math.floor(this.randomPosition*e);return t},nameToMatch(){return this.names[this.nameToMatchPosition]},type(){const e=new Set(this.toRemove.reduce((e,t)=>(e.push(t.type),e),[]));if(e.size>1)return this.t("generic.resource",{count:this.toRemove.length});const t=this.toRemove[0]?.schema;return t?this.$store.getters["type-map/labelFor"](t,this.toRemove.length):"resource"+(1===this.toRemove.length?"":"s")},selfLinks(){return this.toRemove.map(e=>(0,g.get)(e,"links.self"))},needsConfirm(){const e=this.toRemove[0];return e?.confirmRemove},doneLocation(){if(this.toRemove.length>1)return null;if(this.toRemove[0].doneOverride)return this.toRemove[0].doneOverride;const e=this.toRemove[0].currentRoute(),t={},o={...e.params};if(o.id&&(o.id===this.toRemove[0]?.metadata?.name||o.id===this.toRemove[0].id)){let{name:s=""}=e;const r=s.indexOf("-id");if(-1!==r&&(s=s.slice(0,r)),o.namespace){const e=s.indexOf("-namespace");-1!==e&&(s=s.slice(0,e)),delete o.namespace}delete o.id,t.params=o,t.name=s}return t},currentRouter(){return this.doneLocation?this.toRemove[0].currentRouter():null},protip(){return this.t("promptRemove.protip",{alternateLabel:k.ZA})},deleteDisabled(){const e=this.needsConfirm&&this.confirmName!==this.nameToMatch;return this.preventDelete||e},...(0,f.aH)("action-menu",["showPromptRemove","toRemove"]),...(0,f.L8)({t:"i18n/t"})},watch:{showPromptRemove(e){if(e){const e=this.toRemove[0];"c-cluster-explorer-tools"===this.currentRouter?.currentRoute?.value?.name&&e.type===L.W8.APP&&e.spec?.chart?.metadata?.annotations[D.W8.AUTO_INSTALL]&&(this.chartsToRemoveIsApp=!0),this.showModal=!0;let{resource:t}=this.$route.params;this.toRemove.length>0&&(t=e.type),this.hasCustomRemove=this.$store.getters["type-map/hasCustomPromptRemove"](t),this.removeComponent=(0,R.IJ)(this.$store.getters["type-map/importCustomPromptRemove"](t))}else this.showModal=!1},toRemove(e){let t;const o=e.filter(e=>e.preventDeletionMessage);if(this.preventDelete=!1,o.length)this.preventDelete=!0,t=o[0].preventDeletionMessage;else{const o=e.filter(e=>e.warnDeletionMessage);o.length&&(t=o[0].warnDeletionMessage)}this.warning="function"===typeof t?t(this.toRemove):t||""}},methods:{resourceNames:y.Nr,escapeHtml:y.ZD,close(){this.confirmName="",this.error="",this.chartsDeleteCrd=!1,this.chartsToRemoveIsApp=!1,this.cachedDoneLocation=null,this.$store.commit("action-menu/togglePromptRemove")},async remove(e){if(this.doneLocation?this.cachedDoneLocation={...this.doneLocation}:this.cachedDoneLocation=null,this.hasCustomRemove&&this.$refs?.customPrompt?.remove){let t=this.$refs.customPrompt.remove(e);if(t&&t.then)try{t=await t}catch(o){return this.error=o,void e(!1)}if(void 0===t||t)return}const t=this.toRemove.some(e=>e.removeSerially);t?this.serialRemove(e):this.parallelRemove(e)},async serialRemove(e){try{const e=this.getSpoofedTypes(this.toRemove);for(const t of this.toRemove)await t.remove();await this.refreshSpoofedTypes(e),this.done()}catch(t){this.error=t.message||t,e(!1)}},async parallelRemove(e){try{"undefined"!==typeof this.toRemove[0].bulkRemove?await this.toRemove[0].bulkRemove(this.toRemove,{}):await Promise.all(this.toRemove.map(e=>e.remove()));const e=this.getSpoofedTypes(this.toRemove);await this.refreshSpoofedTypes(e),this.done()}catch(t){this.error=t.message||t,e(!1)}},done(){!(0,g.isEmpty)(this.cachedDoneLocation)&&this.currentRouter&&this.currentRouter.push(this.cachedDoneLocation),this.close()},getSpoofedTypes(e){const t=(0,w.sb)(this.toRemove.map(e=>e.type));return t.filter(this.$store.getters["type-map/isSpoofed"])},refreshSpoofedTypes(e){const t=this.$store.getters["currentProduct"].inStore,o=e.map(e=>this.$store.dispatch(`${t}/findAll`,{type:e,opt:{force:!0}},{root:!0}));return Promise.all(o)},async chartAddCrdToRemove(){try{const e=await this.toRemove[0].relatedResourcesToRemove();this.toRemove.includes(e)?this.chartsDeleteCrd||this.toRemove.pop(e):this.toRemove.push(e)}catch(e){this.error=e,this.chartsDeleteCrd=!1}}}};o(89965);var A=o(66262);const P=(0,A.A)(_,[["render",u]]),W=P},85667:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>c});var s=o(31601),r=o.n(s),n=o(76314),a=o.n(n),i=o(5111),m=a()(r());m.i(i.A),m.push([e.id,".prompt-remove.card-container{box-shadow:none}.prompt-remove #confirm{width:90%;margin-left:3px}.prompt-remove .actions{text-align:right}.prompt-remove .card-actions{display:flex}.prompt-remove .card-actions .spacer{flex:1}.prompt-remove .confirm-text b{-webkit-user-select:all;-moz-user-select:all;user-select:all}",""]);const c=m},89965:(e,t,o)=>{var s=o(85667);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var r=o(99548).A;r("169ba66a",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=8833.f129d419.js.map