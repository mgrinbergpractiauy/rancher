(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[5784],{32760:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var n=s(31601),i=s.n(n),r=s(76314),a=s.n(r),o=s(5111),u=a()(i());u.i(o.A),u.push([e.id,".user-retention[data-v-65cf4ee6]{height:100%}.user-retention-content[data-v-65cf4ee6]{height:100%;overflow-y:scroll}.form-user-retention[data-v-65cf4ee6]{display:flex;flex:1;flex-direction:column;gap:1.5rem}.footer-user-retention[data-v-65cf4ee6]{border-top:var(--header-border-size) solid var(--header-border);background-color:var(--header-bg);margin-left:-20px;margin-right:-20px;margin-bottom:-20px;margin-top:20px;padding:10px 20px;height:60px}.footer-user-retention[data-v-65cf4ee6]  .spacer-small{padding:0}.input-fieldset[data-v-65cf4ee6]{display:flex;flex-direction:column;gap:.75rem}.input-fieldset.condensed[data-v-65cf4ee6]{gap:.25rem}.input-fieldset.pt-12[data-v-65cf4ee6]{padding-top:3rem}.input-field[data-v-65cf4ee6]{max-width:24rem}.input-detail[data-v-65cf4ee6]{color:var(--input-label);padding-left:61px}",""]);const d=u},43522:function(e){!function(t,s){e.exports=s()}(0,function(){"use strict";var e,t,s=1e3,n=6e4,i=36e5,r=864e5,a=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,o=31536e6,u=2628e6,d=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,l={years:o,months:u,days:r,hours:i,minutes:n,seconds:s,milliseconds:1,weeks:6048e5},c=function(e){return e instanceof _},h=function(e,t,s){return new _(e,s,t.$l)},f=function(e){return t.p(e)+"s"},m=function(e){return e<0},v=function(e){return m(e)?Math.ceil(e):Math.floor(e)},E=function(e){return Math.abs(e)},p=function(e,t){return e?m(e)?{negative:!0,format:""+E(e)+t}:{negative:!1,format:""+e+t}:{negative:!1,format:""}},_=function(){function m(e,t,s){var n=this;if(this.$d={},this.$l=s,void 0===e&&(this.$ms=0,this.parseFromMilliseconds()),t)return h(e*l[f(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==typeof e)return Object.keys(e).forEach(function(t){n.$d[f(t)]=e[t]}),this.calMilliseconds(),this;if("string"==typeof e){var i=e.match(d);if(i){var r=i.slice(2).map(function(e){return null!=e?Number(e):0});return this.$d.years=r[0],this.$d.months=r[1],this.$d.weeks=r[2],this.$d.days=r[3],this.$d.hours=r[4],this.$d.minutes=r[5],this.$d.seconds=r[6],this.calMilliseconds(),this}}return this}var E=m.prototype;return E.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce(function(t,s){return t+(e.$d[s]||0)*l[s]},0)},E.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=v(e/o),e%=o,this.$d.months=v(e/u),e%=u,this.$d.days=v(e/r),e%=r,this.$d.hours=v(e/i),e%=i,this.$d.minutes=v(e/n),e%=n,this.$d.seconds=v(e/s),e%=s,this.$d.milliseconds=e},E.toISOString=function(){var e=p(this.$d.years,"Y"),t=p(this.$d.months,"M"),s=+this.$d.days||0;this.$d.weeks&&(s+=7*this.$d.weeks);var n=p(s,"D"),i=p(this.$d.hours,"H"),r=p(this.$d.minutes,"M"),a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3,a=Math.round(1e3*a)/1e3);var o=p(a,"S"),u=e.negative||t.negative||n.negative||i.negative||r.negative||o.negative,d=i.format||r.format||o.format?"T":"",l=(u?"-":"")+"P"+e.format+t.format+n.format+d+i.format+r.format+o.format;return"P"===l||"-P"===l?"P0D":l},E.toJSON=function(){return this.toISOString()},E.format=function(e){var s=e||"YYYY-MM-DDTHH:mm:ss",n={Y:this.$d.years,YY:t.s(this.$d.years,2,"0"),YYYY:t.s(this.$d.years,4,"0"),M:this.$d.months,MM:t.s(this.$d.months,2,"0"),D:this.$d.days,DD:t.s(this.$d.days,2,"0"),H:this.$d.hours,HH:t.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:t.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:t.s(this.$d.seconds,2,"0"),SSS:t.s(this.$d.milliseconds,3,"0")};return s.replace(a,function(e,t){return t||String(n[e])})},E.as=function(e){return this.$ms/l[f(e)]},E.get=function(e){var t=this.$ms,s=f(e);return"milliseconds"===s?t%=1e3:t="weeks"===s?v(t/l[s]):this.$d[s],t||0},E.add=function(e,t,s){var n;return n=t?e*l[f(t)]:c(e)?e.$ms:h(e,this).$ms,h(this.$ms+n*(s?-1:1),this)},E.subtract=function(e,t){return this.add(e,t,!0)},E.locale=function(e){var t=this.clone();return t.$l=e,t},E.clone=function(){return h(this.$ms,this)},E.humanize=function(t){return e().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},E.valueOf=function(){return this.asMilliseconds()},E.milliseconds=function(){return this.get("milliseconds")},E.asMilliseconds=function(){return this.as("milliseconds")},E.seconds=function(){return this.get("seconds")},E.asSeconds=function(){return this.as("seconds")},E.minutes=function(){return this.get("minutes")},E.asMinutes=function(){return this.as("minutes")},E.hours=function(){return this.get("hours")},E.asHours=function(){return this.as("hours")},E.days=function(){return this.get("days")},E.asDays=function(){return this.as("days")},E.weeks=function(){return this.get("weeks")},E.asWeeks=function(){return this.as("weeks")},E.months=function(){return this.get("months")},E.asMonths=function(){return this.as("months")},E.years=function(){return this.get("years")},E.asYears=function(){return this.as("years")},m}(),g=function(e,t,s){return e.add(t.years()*s,"y").add(t.months()*s,"M").add(t.days()*s,"d").add(t.hours()*s,"h").add(t.minutes()*s,"m").add(t.seconds()*s,"s").add(t.milliseconds()*s,"ms")};return function(s,n,i){e=i,t=i().$utils(),i.duration=function(e,t){var s=i.locale();return h(e,{$l:s},t)},i.isDuration=c;var r=n.prototype.add,a=n.prototype.subtract;n.prototype.add=function(e,t){return c(e)?g(this,e,1):r.bind(this)(e,t)},n.prototype.subtract=function(e,t){return c(e)?g(this,e,-1):a.bind(this)(e,t)}}})},48514:(e,t,s)=>{var n=s(32760);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var i=s(99548).A;i("30b25f6a",n,!0,{sourceMap:!1,shadowMode:!1})},95784:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var n=s(20641),i=s(50953),r=s(75220),a=s(95753);const o=(0,n.pM)({__name:"user-retention-header",setup(e,{expose:t}){t();const s={get TabTitle(){return a.A}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),u=o,d=u;var l=s(64422),c=s(66278),h=s(66986),f=s(95822),m=s(3378),v=s(74353),E=s.n(v),p=s(43522),_=s.n(p);E().extend(_());class g extends Error{constructor(e){super(e),this.isExpected=!0,this.name="ExpectedError"}}const S=(e,t,s)=>{const r=(0,c.Pj)(),{t:a}=(0,h.s)(r),o=(0,i.KR)({[f.HG.DISABLE_INACTIVE_USER_AFTER]:!0,[f.HG.DELETE_INACTIVE_USER_AFTER]:!0,[f.HG.USER_RETENTION_CRON]:!0}),u=(0,n.EW)(()=>{const e=o.value;return!Object.values(e).includes(!1)}),d=(e,t)=>{o.value[e]=t},l=e=>{const{[e]:t,...s}=o.value;o.value=s},v=e=>{o.value={...o.value,[e]:!0}},p=e=>{const t=/^(\d+)h|(\d+)m|(\d+)s$/,s=null===e||void 0===e?void 0:e.match(t);if(!s)throw new g("Invalid duration format. Accepted duration units are Hours, Minutes, and Seconds ({h|m|s})");const n=s[1]?parseInt(s[1]):0,i=s[2]?parseInt(s[2]):0,r=s[3]?parseInt(s[3]):0;return E().duration({hours:n,minutes:i,seconds:r})},_=s=>{if(e.value||t.value)return!s||"string"===typeof s&&!(0,m.isValidCron)(s)?a("user.retention.edit.form.cron.errorMessage"):void 0},S=t=>{if(e.value)try{p(t)}catch(s){return s.message}},A=e=>{if(t.value)try{p(e)}catch(s){return s.message}},$=e=>{try{const t=p(e),s=E().duration({hours:336});if(t.asMilliseconds()<s.asMilliseconds())return`Invalid value: "${e}": must be at least 336h0m0s`}catch(t){if(!(t instanceof g))return t.message}},T=e=>{var t,n;try{const i=p(e),r=E().duration({minutes:null===(t=s.value)||void 0===t?void 0:t.value});if(i.asMilliseconds()<r.asMilliseconds())return`Invalid value: "${e}": must be at least ${f.HG.AUTH_USER_SESSION_TTL_MINUTES} (${null===(n=s.value)||void 0===n?void 0:n.value}m)`}catch(i){if(!(i instanceof g))return i.message}};return{validateUserRetentionCron:_,validateDisableInactiveUserAfterDuration:S,validateDeleteInactiveUserAfterDuration:A,validateDeleteInactiveUserAfter:$,validateDurationAgainstAuthUserSession:T,setValidation:d,removeValidation:l,addValidation:v,isFormValid:u}};var A=s(55823),$=s(84010),T=s(59069),I=s(54012),R=s(47822),y=s(48805);const U=(0,n.pM)({__name:"index",setup(e,{expose:t}){t();const s=(0,c.Pj)(),a=(0,i.Kh)({[f.HG.DISABLE_INACTIVE_USER_AFTER]:null,[f.HG.DELETE_INACTIVE_USER_AFTER]:null,[f.HG.USER_RETENTION_CRON]:null,[f.HG.USER_RETENTION_DRY_RUN]:null,[f.HG.USER_LAST_LOGIN_DEFAULT]:null}),o=(0,i.KR)(null),u=(0,i.KR)(!1),m=(0,i.KR)(!1),v=(0,i.KR)(!0),{validateUserRetentionCron:p,validateDisableInactiveUserAfterDuration:_,validateDeleteInactiveUserAfterDuration:g,validateDeleteInactiveUserAfter:U,validateDurationAgainstAuthUserSession:D,setValidation:M,removeValidation:N,addValidation:b,isFormValid:H}=S(u,m,o);let w={};(0,n.wB)(u,e=>{a[f.HG.DISABLE_INACTIVE_USER_AFTER]=e?w[f.HG.DISABLE_INACTIVE_USER_AFTER].value:null}),(0,n.wB)(m,e=>{a[f.HG.DELETE_INACTIVE_USER_AFTER]=e?w[f.HG.DELETE_INACTIVE_USER_AFTER].value:null}),(0,n.wB)([u,m],([e,t])=>{if(!e&&!t)return x.forEach(e=>{a[e]=null}),void N(f.HG.USER_RETENTION_CRON);x.filter(e=>![f.HG.DISABLE_INACTIVE_USER_AFTER,f.HG.DELETE_INACTIVE_USER_AFTER].includes(e)).forEach(G),b(f.HG.USER_RETENTION_CRON)});const G=e=>{if(w[e].id===f.HG.USER_LAST_LOGIN_DEFAULT&&w[e].value&&"string"===typeof w[e].value){const t=w[e].value;return void(a[e]=E()(t).valueOf().toString())}a[e]=w[e].value},V=async e=>await s.dispatch("management/find",{type:A.Mc.SETTING,id:e}),x=Object.keys(a),O=x.map(e=>V(e));(0,n.sV)(async()=>{w=await Promise.all(O).then(e=>e.reduce((e,t)=>({[t.id]:t,...e}),{})),x.forEach(G),o.value=await V(f.HG.AUTH_USER_SESSION_TTL_MINUTES),u.value=!!a[f.HG.DISABLE_INACTIVE_USER_AFTER],m.value=!!a[f.HG.DELETE_INACTIVE_USER_AFTER],v.value=!1});const{t:L}=(0,h.s)(s),C=(0,i.KR)(null),F=async e=>{try{C.value=null,x.forEach(e=>{w[e].value=a[e],e===f.HG.USER_LAST_LOGIN_DEFAULT&&a[e]&&(w[e].value=E()(Number(a[e])).format())}),await Promise.all(x.map(e=>w[e].save())),e(!0),s.dispatch("growl/success",{title:L("user.retention.growl.title"),message:L("user.retention.growl.message")},{root:!0}),Y()}catch(t){C.value=t.message,e(!1)}},k=(0,r.rd)(),Y=()=>{k.back()};(0,r.V6)((e,t)=>{(0,$.isAdminUser)(s.getters)||k.replace({name:"home"})});const P={store:s,userRetentionSettings:a,authUserSessionTtlMinutes:o,disableAfterPeriod:u,deleteAfterPeriod:m,loading:v,validateUserRetentionCron:p,validateDisableInactiveUserAfterDuration:_,validateDeleteInactiveUserAfterDuration:g,validateDeleteInactiveUserAfter:U,validateDurationAgainstAuthUserSession:D,setValidation:M,removeValidation:N,addValidation:b,isFormValid:H,get settings(){return w},set settings(e){w=e},assignSettings:G,fetchSetting:V,ids:x,settingPromises:O,t:L,error:C,save:F,router:k,routeBack:Y,UserRetentionHeader:d,Footer:l.A,get SETTING(){return f.HG},Banner:T.A,Checkbox:I.A,LabeledInput:R.A,get ToggleSwitch(){return y.j}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}});s(48514);var D=s(66262);const M=(0,D.A)(U,[["__scopeId","data-v-65cf4ee6"]]),N=M}}]);
//# sourceMappingURL=5784.f7d68ec0.js.map