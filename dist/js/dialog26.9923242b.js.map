{"version":3,"file":"js/dialog26.9923242b.js","mappings":"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","sources":["webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/ExtensionCatalogUninstallDialog.vue?e832","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/ExtensionCatalogUninstallDialog.vue","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/ExtensionCatalogUninstallDialog.vue?d7cd","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/ExtensionCatalogUninstallDialog.vue?59aa"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../xterm/css/xterm.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.plugin-install-dialog[data-v-13297eca]{padding:10px}.plugin-install-dialog h4[data-v-13297eca]{font-weight:700}.plugin-install-dialog .dialog-panel[data-v-13297eca]{display:flex;flex-direction:column;min-height:100px}.plugin-install-dialog .dialog-panel .dialog-info[data-v-13297eca]{flex:1}.plugin-install-dialog .dialog-buttons[data-v-13297eca]{display:flex;justify-content:flex-end;margin-top:10px}.plugin-install-dialog .dialog-buttons[data-v-13297eca]>:not(:last-child){margin-right:10px}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<script>\nimport { mapGetters } from 'vuex';\n\nimport { CATALOG, UI_PLUGIN, SERVICE, WORKLOAD_TYPES } from '@shell/config/types';\nimport { UI_PLUGIN_LABELS, UI_PLUGIN_NAMESPACE } from '@shell/config/uiplugins';\nimport { allHash } from '@shell/utils/promise';\n\nimport AsyncButton from '@shell/components/AsyncButton';\n\nexport default {\n  emits: ['close'],\n\n  components: { AsyncButton },\n\n  props: {\n    /**\n     * Catalog object\n     */\n    catalog: {\n      type:     Object,\n      default:  () => {},\n      required: true\n    },\n    /**\n     * Callback to trigger refresh banner on extensions screen\n     */\n    refresh: {\n      type:     Function,\n      default:  () => {},\n      required: true\n    },\n    /**\n     * Callback when modal is closed\n     */\n    closed: {\n      type:     Function,\n      default:  () => {},\n      required: true\n    },\n    resources: {\n      type:    Array,\n      default: () => []\n    },\n    registerBackgroundClosing: {\n      type:    Function,\n      default: () => {}\n    }\n  },\n\n  async fetch() {\n    if ( this.$store.getters['management/schemaFor'](UI_PLUGIN) ) {\n      const plugins = this.$store.dispatch('management/findAll', { type: UI_PLUGIN });\n\n      this.plugins = plugins || [];\n    }\n  },\n\n  data() {\n    return {\n      busy:    false,\n      plugins: null,\n    };\n  },\n\n  computed: {\n    ...mapGetters({ allCharts: 'catalog/charts' }),\n\n    pluginsFromCatalogImage() {\n      return this.plugins.filter((p) => p.metadata?.labels?.[UI_PLUGIN_LABELS.CATALOG_IMAGE]);\n    }\n  },\n\n  methods: {\n    closeDialog(result) {\n      this.closed(result);\n\n      if ( result ) {\n        this.refresh();\n      }\n\n      this.$emit('close');\n    },\n\n    async uninstall() {\n      this.busy = true;\n\n      const catalog = this.catalog;\n      const apps = await this.$store.dispatch('management/findAll', { type: CATALOG.APP });\n      const pluginApps = apps.filter((app) => {\n        if ( app.namespace === UI_PLUGIN_NAMESPACE ) {\n          // Find the related apps from the deployed helm repository\n          const charts = this.allCharts.filter((chart) => chart.repoName === catalog.repo?.metadata?.name);\n\n          return charts.some((chart) => chart.chartName === app.metadata.name);\n        }\n\n        return false;\n      });\n\n      await this.removeCatalogResources(catalog);\n\n      if ( pluginApps.length ) {\n        try {\n          pluginApps.forEach((app) => {\n            app.remove();\n          });\n        } catch (e) {\n          this.$store.dispatch('growl/error', {\n            title:   this.t('plugins.error.generic'),\n            message: e.message ? e.message : e,\n            timeout: 10000\n          }, { root: true });\n        }\n\n        await this.$store.dispatch('management/findAll', { type: CATALOG.OPERATION });\n      }\n\n      this.closeDialog(catalog);\n    },\n\n    async removeCatalogResources(catalog) {\n      if ( catalog.name ) {\n        const namespace = UI_PLUGIN_NAMESPACE;\n        // of type KubeLabelSelector\n        const labelSelector = { matchLabels: { [UI_PLUGIN_LABELS.CATALOG_IMAGE]: catalog.name } };\n\n        const hash = await allHash({\n          deployment: this.$store.dispatch('management/findLabelSelector', {\n            type:     WORKLOAD_TYPES.DEPLOYMENT,\n            matching: { namespace, labelSelector },\n            opt:      { transient: true }\n          }),\n          service: this.$store.dispatch('management/findLabelSelector', {\n            type:     SERVICE,\n            matching: { namespace, labelSelector },\n            opt:      { transient: true }\n          }),\n          repo: this.$store.dispatch('management/findLabelSelector', {\n            type:     CATALOG.CLUSTER_REPO,\n            matching: { labelSelector },\n            opt:      { transient: true }\n          })\n        });\n\n        for ( const resource of Object.keys(hash) ) {\n          if ( hash[resource] ) {\n            hash[resource].data.forEach((r) => r.remove());\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <div class=\"plugin-install-dialog\">\n    <h4 class=\"mt-10\">\n      {{ t('plugins.uninstall.title', { name: catalog.name }) }}\n    </h4>\n    <div class=\"mt-10 dialog-panel\">\n      <div class=\"dialog-info\">\n        <p>\n          {{ t('plugins.uninstall.catalog') }}\n        </p>\n      </div>\n      <div class=\"dialog-buttons\">\n        <button\n          :disabled=\"busy\"\n          class=\"btn role-secondary\"\n          data-testid=\"uninstall-ext-modal-cancel-btn\"\n          @click=\"closeDialog(false)\"\n        >\n          {{ t('generic.cancel') }}\n        </button>\n        <AsyncButton\n          mode=\"uninstall\"\n          data-testid=\"uninstall-ext-modal-uninstall-btn\"\n          @click=\"uninstall()\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n  .plugin-install-dialog {\n    padding: 10px;\n\n    h4 {\n      font-weight: bold;\n    }\n\n    .dialog-panel {\n      display: flex;\n      flex-direction: column;\n      min-height: 100px;\n\n      .dialog-info {\n        flex: 1;\n      }\n    }\n\n    .dialog-buttons {\n      display: flex;\n      justify-content: flex-end;\n      margin-top: 10px;\n\n      > *:not(:last-child) {\n        margin-right: 10px;\n      }\n    }\n  }\n</style>\n","import { render } from \"./ExtensionCatalogUninstallDialog.vue?vue&type=template&id=13297eca&scoped=true\"\nimport script from \"./ExtensionCatalogUninstallDialog.vue?vue&type=script&lang=js\"\nexport * from \"./ExtensionCatalogUninstallDialog.vue?vue&type=script&lang=js\"\n\nimport \"./ExtensionCatalogUninstallDialog.vue?vue&type=style&index=0&id=13297eca&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-13297eca\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../../cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../vue-loader/dist/index.js??ruleSet[0].use[1]!./ExtensionCatalogUninstallDialog.vue?vue&type=style&index=0&id=13297eca&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"33f69c78\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["___CSS_LOADER_EXPORT___","i","push","module","id","class","t","name","catalog","disabled","busy","closeDialog","mode","uninstall","emits","components","AsyncButton","props","type","Object","default","required","refresh","Function","closed","resources","Array","registerBackgroundClosing","fetch","this","$store","getters","plugins","dispatch","data","computed","allCharts","pluginsFromCatalogImage","filter","p","metadata","labels","CATALOG_IMAGE","methods","result","$emit","apps","APP","pluginApps","app","namespace","charts","chart","repoName","repo","some","chartName","removeCatalogResources","length","forEach","remove","e","title","message","timeout","root","OPERATION","labelSelector","matchLabels","hash","deployment","DEPLOYMENT","matching","opt","transient","service","CLUSTER_REPO","resource","keys","r","__exports__","render","content","__esModule","locals","exports","add"],"ignoreList":[],"sourceRoot":""}