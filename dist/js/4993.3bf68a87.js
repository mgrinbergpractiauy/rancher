(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[4993],{6876:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(31601),r=s.n(a),o=s(76314),l=s.n(o),i=s(5111),n=l()(r());n.i(i.A),n.push([e.id,".principal[data-v-283b3124]{display:block;background:var(--box-bg);border:1px solid var(--border);border-radius:3px;margin:10px 0;padding:10px;line-height:40px}.principal img[data-v-283b3124]{vertical-align:middle;margin:0 10px}.setup[data-v-283b3124]{overflow:hidden}.setup .row .checkbox[data-v-283b3124]{margin:auto}.setup .row .span-6[data-v-283b3124]{padding:0 60px;margin:0}.setup .row .landscape[data-v-283b3124]{height:100vh;margin:0;-o-object-fit:cover;object-fit:cover;padding:0;width:49%}.setup .form-col[data-v-283b3124]{display:flex;flex-direction:column;overflow-y:auto;position:relative;height:100vh;width:51%}.setup .form-col>div[data-v-283b3124]:first-of-type{flex:3}.setup .form-col>div[data-v-283b3124]:nth-of-type(2){flex:9}.setup .form-col>div[data-v-283b3124]:nth-of-type(3){flex:2}.setup .setup-title[data-v-283b3124]  code{font-size:12px;padding:0}.setup .setup-errors[data-v-283b3124]{min-height:50px}.setup p[data-v-283b3124]{line-height:20px}",""]);const u=n},34993:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>z});var a=s(20641),r=s(53751),o=s(90033);const l={class:"row"},i={class:"col span-6 form-col"},n={class:"text-center"},u={class:"text-center mb-20 mt-20 setup-title"},d=["value"],p={class:"mb-20"},c={class:"mb-20"},h={class:"addon",style:{padding:"0 0 0 12px"}},v={key:0,class:"mt-20 mb-20",role:"none"},m={class:"mt-20"},b={class:"checkbox pt-10 eula"},g={id:"submit",class:"text-center mt-20"},w={class:"setup-errors mt-20"};function f(e,t,s,f,k,y){const x=(0,a.g2)("Loading"),U=(0,a.g2)("Password"),L=(0,a.g2)("RadioGroup"),C=(0,a.g2)("CopyToClipboard"),$=(0,a.g2)("LabeledInput"),E=(0,a.g2)("t"),P=(0,a.g2)("Banner"),R=(0,a.g2)("Checkbox"),F=(0,a.g2)("AsyncButton"),W=(0,a.g2)("BrandImage"),I=(0,a.gN)("clean-html");return e.$fetchState.pending?((0,a.uX)(),(0,a.Wv)(x,{key:0,mode:"relative"})):((0,a.uX)(),(0,a.CE)("form",{key:1,class:"setup",onSubmit:t[7]||(t[7]=(0,r.D$)(()=>{},["prevent"]))},[(0,a.Lk)("div",l,[(0,a.Lk)("div",i,[t[22]||(t[22]=(0,a.Lk)("div",null,"\n           \n        ",-1)),t[23]||(t[23]=(0,a.eW)()),(0,a.Lk)("div",null,[(0,a.Lk)("h1",n,(0,o.v_)(e.t("setup.welcome",{product:k.product})),1),t[18]||(t[18]=(0,a.eW)()),k.mustChangePassword?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bo)((0,a.Lk)("p",u,null,512),[[I,e.t(k.isFirstLogin?"setup.setPassword":"setup.newUserSetPassword",{username:k.username},!0)]]),t[8]||(t[8]=(0,a.eW)()),k.haveCurrent?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(U,{key:0,value:k.current,"onUpdate:value":t[0]||(t[0]=e=>k.current=e),valueModifiers:{trim:!0},autocomplete:"current-password",type:"password",label:e.t("setup.currentPassword"),class:"mb-20",required:!0},null,8,["value","label"])),t[9]||(t[9]=(0,a.eW)()),(0,a.Lk)("input",{type:"hidden",name:"username",autocomplete:"username",value:k.username},null,8,d),t[10]||(t[10]=(0,a.eW)()),(0,a.Lk)("div",p,[(0,a.bF)(L,{value:k.useRandom,"onUpdate:value":t[1]||(t[1]=e=>k.useRandom=e),"data-testid":"setup-password-mode",name:"password-mode",options:k.passwordOptions},null,8,["value","options"])]),t[11]||(t[11]=(0,a.eW)()),(0,a.Lk)("div",c,[k.useRandom?((0,a.uX)(),(0,a.Wv)($,{key:0,ref:"password",value:k.password,"onUpdate:value":t[2]||(t[2]=e=>k.password=e),valueModifiers:{trim:!0},type:k.useRandom?"text":"password",disabled:k.useRandom,"data-testid":"setup-password-random","label-key":"setup.newPassword"},(0,a.eX)({_:2},[k.useRandom?{name:"suffix",fn:(0,a.k6)(()=>[(0,a.Lk)("div",h,[(0,a.bF)(C,{"aria-label":e.t("setup.copyRandom"),text:k.password,class:"btn-sm"},null,8,["aria-label","text"])])]),key:"0"}:void 0]),1032,["value","type","disabled"])):((0,a.uX)(),(0,a.Wv)(U,{key:1,ref:"password",value:k.password,"onUpdate:value":t[3]||(t[3]=e=>k.password=e),valueModifiers:{trim:!0},label:e.t("setup.newPassword"),"data-testid":"setup-password",required:!0},null,8,["value","label"]))]),t[12]||(t[12]=(0,a.eW)()),(0,a.bo)((0,a.bF)(U,{value:k.confirm,"onUpdate:value":t[4]||(t[4]=e=>k.confirm=e),valueModifiers:{trim:!0},autocomplete:"new-password","data-testid":"setup-password-confirm",label:e.t("setup.confirmPassword"),required:!0},null,8,["value","label"]),[[r.aG,!k.useRandom]])],64)):(0,a.Q3)("",!0),t[19]||(t[19]=(0,a.eW)()),k.isFirstLogin?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[k.mcmEnabled?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[k.mustChangePassword?((0,a.uX)(),(0,a.CE)("hr",v)):(0,a.Q3)("",!0),t[15]||(t[15]=(0,a.eW)()),(0,a.Lk)("p",null,[(0,a.bF)(E,{k:"setup.serverUrl.tip",raw:!0})]),t[16]||(t[16]=(0,a.eW)()),(0,a.Lk)("div",m,[y.showLocalhostWarning?((0,a.uX)(),(0,a.Wv)(P,{key:0,color:"warning",label:e.t("validation.setting.serverUrl.localhost"),"data-testid":"setup-serverurl-localhost-warning"},null,8,["label"])):(0,a.Q3)("",!0),t[13]||(t[13]=(0,a.eW)()),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.fvGetPathErrors(["serverUrl"]),(e,t)=>((0,a.uX)(),(0,a.Wv)(P,{key:t,color:"error",label:e,"data-testid":"setup-error-banner"},null,8,["label"]))),128)),t[14]||(t[14]=(0,a.eW)()),(0,a.bF)($,{value:k.serverUrl,"onUpdate:value":[t[5]||(t[5]=e=>k.serverUrl=e),y.onServerUrlChange],label:e.t("setup.serverUrl.label"),"data-testid":"setup-server-url",rules:e.fvGetAndReportPathRules("serverUrl"),required:!0},null,8,["value","label","rules","onUpdate:value"])])],64)):(0,a.Q3)("",!0),t[17]||(t[17]=(0,a.eW)()),(0,a.Lk)("div",b,[(0,a.bF)(R,{id:"checkbox-eula",value:k.eula,"onUpdate:value":t[6]||(t[6]=e=>k.eula=e),"data-testid":"setup-agreement"},{label:(0,a.k6)(()=>[(0,a.bF)(E,{k:"setup.eula",raw:!0,name:k.productName},null,8,["name"])]),_:1},8,["value"])])],64)):(0,a.Q3)("",!0),t[20]||(t[20]=(0,a.eW)()),(0,a.Lk)("div",g,[(0,a.bF)(F,{key:"passwordSubmit",type:"submit",mode:"continue",disabled:!y.saveEnabled,"data-testid":"setup-submit",onClick:y.save},null,8,["disabled","onClick"])]),t[21]||(t[21]=(0,a.eW)()),(0,a.Lk)("div",w,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.errors,(e,t)=>((0,a.uX)(),(0,a.CE)("h4",{key:t,class:"text-error text-center"},(0,o.v_)(e),1))),128))])]),t[24]||(t[24]=(0,a.eW)()),t[25]||(t[25]=(0,a.Lk)("div",null,"\n           \n        ",-1))]),t[26]||(t[26]=(0,a.eW)()),(0,a.bF)(W,{class:"col span-6 landscape","file-name":"login-landscape.svg"})])],32))}var k=s(72140),y=s(16372),x=s(40913),U=s(72268),L=s(46405),C=s(55823),$=s(65843),E=s(35800),P=s(10874),R=s(22516),F=s(4365),W=s(95822),I=s(37447),G=s(21782),S=s(84010),A=s(64430),_=s(77794),M=s(14492),T=s(95100),X=s(42673),N=s.n(X),q=s(1053),H=s(57090),B=s(96763);const K=e=>{const t=e.getters["management/byId"](C.Mc.SETTING,W.HG.FIRST_LOGIN);return"true"===t?.value},O=async e=>{await e.dispatch("auth/getUser");const t=e.getters["auth/v3User"]?.mustChangePassword;return t},Q={mixins:[T.A],data(){return{passwordOptions:[{label:this.t("setup.useRandom"),value:!0},{label:this.t("setup.useManual"),value:!1}],fvFormRuleSets:[{path:"serverUrl",rootObject:this,rules:["required","https","url","trailingForwardSlash"]}],productName:"",vendor:(0,P.f7)(),product:(0,P.oo)(),step:parseInt(this.$route.query.step,10)||1,useRandom:!0,haveCurrent:!1,username:null,isFirstLogin:!1,mustChangePassword:!1,current:null,password:(0,k.vx)(),confirm:null,v3User:null,serverUrl:null,mcmEnabled:null,eula:!1,principals:null,errors:[]}},async beforeCreate(){const e=K(this.$store),t=await O(this.$store);if(!e){if(t){if(this.$store.getters["auth/initialPass"])return;return await this.$store.dispatch("auth/logout",null,{root:!0}),this.$router.replace(`/auth/login?${L.gZ}`)}return this.$router.replace("/")}},components:{AsyncButton:U.A,LabeledInput:y.o,CopyToClipboard:x.A,Checkbox:E.S,RadioGroup:R.z,Password:G.A,BrandImage:A.A,Banner:M.l,Loading:H.A},async fetch(){const e=this.$store.getters["management/byId"](C.Mc.SETTING,W.HG.SERVER_URL);let t;try{t=this.$store.getters["management/byId"](C.Mc.SETTING,W.HG.PL)}catch(c){t=await this.$store.dispatch("rancher/find",{type:C.k$.SETTING,id:W.HG.PL,opt:{url:`/v3/settings/${W.HG.PL}`}})}t.value?.length&&t.value!==(0,P.f7)()&&(0,P.xc)(t.value);const s=t.default,a=await this.$store.dispatch("rancher/findAll",{type:C.k$.PRINCIPAL,opt:{url:"/v3/principals"}}),r=(0,$.jq)(a,"me",!0),o=this.$route.query[L.K1]||this.$store.getters["auth/initialPass"],l=this.$store.getters["auth/v3User"]??{},i=await this.$store.dispatch("management/find",{type:C.Mc.FEATURE,id:"multi-cluster-management",opt:{url:`/v1/${C.Mc.FEATURE}/multi-cluster-management`}}),n=(i?.spec?.value||i?.status?.default)&&"Harvester"!==s;let u;u=e?.value?e.value:window.location.origin;const d=await K(this.$store),p=await O(this.$store);this["productName"]=s,this["haveCurrent"]=!!o,this["username"]=r?.loginName||"admin",this["isFirstLogin"]=d,this["mustChangePassword"]=p,this["current"]=o,this["v3User"]=l,this["serverUrl"]=u,this["mcmEnabled"]=n,this["principals"]=a},computed:{saveEnabled(){if(!this.eula&&this.isFirstLogin)return!1;if(this.mustChangePassword){if(!this.current)return!1;if(!this.useRandom&&(!this.password||this.password!==this.confirm))return!1}return!(!N()(this.serverUrl)||this.fvGetPathErrors(["serverUrl"]).length>0)},me(){const e=(0,$.jq)(this.principals,"me",!0);return e},showLocalhostWarning(){return(0,q.M8)(this.serverUrl)}},watch:{useRandom(e){e?this.password=(0,k.vx)():(this.password="",this.$nextTick(()=>{this.$refs.password.focus()}))}},methods:{async save(e){const t=[];try{await(0,S.applyProducts)(this.$store,this.$plugin),await this.$store.dispatch("loadManagement"),this.mustChangePassword?await this.$store.dispatch("rancher/request",{url:"/v3/users?action=changepassword",method:"post",data:{currentPassword:this.current,newPassword:this.password}}):t.push((0,F.ZC)(this.$store,W.HG.FIRST_LOGIN,"false"));const s=this.v3User;s.mustChangePassword=!1,this.$store.dispatch("auth/gotUser",s),this.isFirstLogin&&(t.push((0,F.ZC)(this.$store,W.HG.EULA_AGREED,(new Date).toISOString())),this.mcmEnabled&&this.serverUrl&&t.push((0,F.ZC)(this.$store,W.HG.SERVER_URL,this.serverUrl))),await Promise.all(t),await(0,_.f)(()=>!K(this.$store),"first login to be completed",1e4,1e3,!0),e(!0),this.done()}catch(s){B.error(s),e(!1),this.errors=(0,I.rz)(s)}},done(){this.$router.replace("/")},onServerUrlChange(e){this.serverUrl=e.trim()}}};s(39598);var j=s(66262);const Z=(0,j.A)(Q,[["render",f],["__scopeId","data-v-283b3124"]]),z=Z},39598:(e,t,s)=>{var a=s(6876);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var r=s(99548).A;r("edc8e174",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=4993.3bf68a87.js.map