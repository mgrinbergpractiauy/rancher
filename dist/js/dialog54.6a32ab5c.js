(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[304],{15880:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>w});var r=s(20641),a=s(90033);const o={class:"text-default-text"},n={class:"pl-10 pr-10"},c={key:0},l={key:0,class:"pt-10 pb-10"},i={class:"buttons"};function p(t,e,s,p,d,u){const h=(0,r.g2)("Banner"),y=(0,r.g2)("AsyncButton"),g=(0,r.g2)("Card"),k=(0,r.gN)("clean-html");return(0,r.uX)(),(0,r.Wv)(g,{class:"prompt-rotate","show-highlight-border":!1},{title:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("h4",o,null,512),[[k,t.t("promptRotateEncryptionKey.title")]])]),body:(0,r.k6)(()=>[(0,r.Lk)("div",n,[(0,r.bF)(h,{color:"warning","label-key":"promptRotateEncryptionKey.warning"}),e[1]||(e[1]=(0,r.eW)()),t.$fetchState.pending?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",c,[d.latestBackup?((0,r.uX)(),(0,r.CE)("p",l,(0,a.v_)(t.t("promptRotateEncryptionKey.description",d.latestBackup,!0)),1)):((0,r.uX)(),(0,r.Wv)(h,{key:1,color:"error","label-key":"promptRotateEncryptionKey.error"}))]))])]),actions:(0,r.k6)(()=>[(0,r.Lk)("div",i,[(0,r.Lk)("button",{class:"btn role-secondary mr-10",onClick:e[0]||(e[0]=(...t)=>u.close&&u.close(...t))},(0,a.v_)(t.t("generic.cancel")),1),e[2]||(e[2]=(0,r.eW)()),(0,r.bF)(y,{mode:"rotate",disabled:t.$fetchState.pending||!d.latestBackup,onClick:u.apply},null,8,["disabled","onClick"]),e[3]||(e[3]=(0,r.eW)()),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.errors,(t,e)=>((0,r.uX)(),(0,r.Wv)(h,{key:e,color:"error",label:t},null,8,["label"]))),128))])]),_:1,__:[4,5]})}var d=s(55823),u=s(72268),h=s(40949),y=s(14492),g=s(37447),k=s(18561),f=s(74353),b=s.n(f),m=s(72140),v=s(86691),_=s(6826);const C={emits:["close"],components:{Card:h.Z,AsyncButton:u.A,Banner:y.l},props:{cluster:{type:Object,default:()=>({})}},async fetch(){if(!this.$store.getters["isRancher"])return[];const t=await this.getEtcdBackups();if(t.length>0){const e=(0,k.Ul)(t,["created"]).reverse(),s=e[0].id.split(":"),r=e[0].created;this.latestBackup={name:s[0],date:this.getFormattedCreatedDate(r)}}},data(){return{errors:[],latestBackup:null}},methods:{close(t){t&&"function"===typeof t&&t(!0),this.$emit("close")},async getEtcdBackups(){let t=await this.$store.dispatch("management/findAll",{type:d.xO});return t=t.filter(t=>t.clusterId===this.cluster.id),t},getFormattedCreatedDate(t){const e=(0,m.ZD)(this.$store.getters["prefs/get"](v.DATE_FORMAT)),s=(0,m.ZD)(this.$store.getters["prefs/get"](v.TIME_FORMAT)),r=b()(t).format(e),a=b()(t).format(s);return`${r} ${a}`},async apply(t){try{const e=this.cluster.spec?.rkeConfig?.rotateEncryptionKeys?.generation||0;(0,_.set)(this.cluster,"spec.rkeConfig.rotateEncryptionKeys.generation",e+1),await this.cluster.save(),this.close(t)}catch(e){this.errors=(0,g.rz)(e),t(!1)}}}};s(79639);var E=s(66262);const B=(0,E.A)(C,[["render",p],["__scopeId","data-v-12d05b8e"]]),w=B},17929:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var r=s(31601),a=s.n(r),o=s(76314),n=s.n(o),c=s(5111),l=n()(a());l.i(c.A),l.push([t.id,".prompt-rotate[data-v-12d05b8e]{margin:0}.buttons[data-v-12d05b8e]{display:flex;justify-content:flex-end;width:100%}",""]);const i=l},79639:(t,e,s)=>{var r=s(17929);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=s(99548).A;a("642aafd8",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog54.6a32ab5c.js.map