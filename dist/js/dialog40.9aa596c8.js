(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[8559],{962:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>u});var n=i(31601),s=i.n(n),a=i(76314),l=i.n(a),o=i(5111),r=l()(s());r.i(o.A),r.push([t.id,".plugin-install-dialog[data-v-6d547632]{padding:10px}.plugin-install-dialog h4[data-v-6d547632]{font-weight:700}.plugin-install-dialog .dialog-panel[data-v-6d547632]{display:flex;flex-direction:column;min-height:100px}.plugin-install-dialog .dialog-panel p[data-v-6d547632]{margin-bottom:5px}.plugin-install-dialog .dialog-panel .dialog-info[data-v-6d547632]{flex:1}.plugin-install-dialog .dialog-panel .toggle-advanced[data-v-6d547632]{display:flex;align-items:center;cursor:pointer;margin:10px 0}.plugin-install-dialog .dialog-panel .toggle-advanced[data-v-6d547632]:hover{text-decoration:none;color:var(--link)}.plugin-install-dialog .dialog-panel .version-selector[data-v-6d547632]{margin:0 10px 10px 10px;width:auto}.plugin-install-dialog .dialog-buttons[data-v-6d547632]{display:flex;justify-content:flex-end;margin-top:10px}.plugin-install-dialog .dialog-buttons[data-v-6d547632]>:not(:last-child){margin-right:10px}",""]);const u=r},8287:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>N});var n=i(20641),s=i(90033);const a={class:"plugin-install-dialog"},l={class:"mt-10"},o={class:"custom mt-10"},r={class:"dialog-panel"},u={key:3},d={class:"dialog-buttons"},c=["disabled"];function h(t,e,i,h,p,g){const v=(0,n.g2)("Banner"),f=(0,n.g2)("LabeledSelect"),m=(0,n.g2)("AsyncButton");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.Lk)("h4",l,(0,s.v_)(t.t(`plugins.${g.buttonMode}.title`,{name:`"${i.plugin?.label}"`},!0)),1),e[7]||(e[7]=(0,n.eW)()),(0,n.Lk)("div",o,[(0,n.Lk)("div",r,[(0,n.Lk)("p",null,(0,s.v_)(t.t(`plugins.${g.buttonMode}.prompt`)),1),e[2]||(e[2]=(0,n.eW)()),g.chartVersionLoadsWithoutAuth?((0,n.uX)(),(0,n.Wv)(v,{key:0,color:"warning",label:t.t("plugins.warnNoAuth")},null,8,["label"])):(0,n.Q3)("",!0),e[3]||(e[3]=(0,n.eW)()),i.plugin?.certified?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(v,{key:1,color:"warning",label:t.t("plugins.install.warnNotCertified")},null,8,["label"])),e[4]||(e[4]=(0,n.eW)()),g.showVersionSelector?((0,n.uX)(),(0,n.Wv)(f,{key:2,value:p.version,"onUpdate:value":e[0]||(e[0]=t=>p.version=t),"label-key":"plugins.install.version",options:g.versionOptions,class:"version-selector mt-10","data-testid":"install-ext-modal-select-version"},null,8,["value","options"])):((0,n.uX)(),(0,n.CE)("div",u,(0,s.v_)(t.t("plugins.install.version"))+" "+(0,s.v_)(p.version),1))]),e[6]||(e[6]=(0,n.eW)()),(0,n.Lk)("div",d,[(0,n.Lk)("button",{disabled:p.busy,class:"btn role-secondary","data-testid":"install-ext-modal-cancel-btn",onClick:e[1]||(e[1]=t=>g.closeDialog(!1))},(0,s.v_)(t.t("generic.cancel")),9,c),e[5]||(e[5]=(0,n.eW)()),(0,n.bF)(m,{mode:g.buttonMode,icon:g.buttonIcon,"data-testid":"install-ext-modal-install-btn",onClick:g.install},null,8,["mode","icon","onClick"])])])])}var p=i(72268),g=i(85158),v=i(55823),f=i(96676),m=i(62428),b=i(59069),y=i(95822),V=i(19916);const w={emits:["close"],components:{AsyncButton:p.A,Banner:b.A,LabeledSelect:g.A},props:{plugin:{type:Object,default:()=>{},required:!0},initialVersion:{type:String,default:null},action:{type:String,default:"",required:!0},updateStatus:{type:Function,default:()=>{},required:!0},closed:{type:Function,default:()=>{},required:!0},resources:{type:Array,default:()=>[]},registerBackgroundClosing:{type:Function,default:()=>{}}},async fetch(){if(this.plugin.installed&&(this.currentVersion=this.plugin.installedVersion),this.initialVersion)this.version=this.initialVersion;else if("upgrade"===this.action)this.version=this.plugin?.installableVersions?.[0]?.version;else if("downgrade"===this.action){const t=this.plugin.installableVersions,e=t.findIndex(t=>t.version===this.currentVersion);-1!==e&&e<t.length-1&&(this.version=t[e+1].version)}else this.version=this.plugin?.installableVersions?.[0]?.version;this.version||(this.version=this.plugin?.installableVersions?.[0]?.version),this.busy=!1,this.update="install"!==this.action,this.defaultRegistrySetting=await this.$store.dispatch("management/find",{type:v.Mc.SETTING,id:y.HG.SYSTEM_DEFAULT_REGISTRY})},data(){return{currentVersion:"",defaultRegistrySetting:null,busy:!1,version:"",update:!1,chartVersionInfo:null}},computed:{showVersionSelector(){return this.versionOptions?.length>1},versionOptions(){return this.plugin?.installableVersions?this.plugin.installableVersions.map(t=>{const e=t.version===this.currentVersion;return{label:(0,V.Y)(t)+(e?` (${this.t("plugins.labels.current")})`:""),value:t.version,disabled:e}}):[]},buttonMode(){if("install"===this.action)return"install";if(this.currentVersion&&this.version){if((0,m.o6)(this.version,this.currentVersion))return"upgrade";if((0,m.o6)(this.currentVersion,this.version))return"downgrade"}return this.action},chartVersionLoadsWithoutAuth(){return this.chartVersionInfo?.values?.plugin?.noAuth},returnFocusSelector(){return`[data-testid="extension-card-${this.action}-btn-${this.plugin?.name}"]`},buttonIcon(){if(this.busy)return"";switch(this.buttonMode){case"install":return"icon-plus";case"upgrade":return"icon-upgrade-alt";case"downgrade":return"icon-downgrade-alt";default:return""}}},methods:{async loadVersionInfo(){try{this.busy=!0;const t=this.plugin,e=t.versions?.find(t=>t.version===this.version);if(!e)return void(this.busy=!1);this.chartVersionInfo=await this.$store.dispatch("catalog/getVersionInfo",{repoType:e.repoType,repoName:e.repoName,chartName:t.chart.chartName,versionName:this.version})}catch(t){}finally{this.busy=!1}},closeDialog(t){this.closed(t),this.$emit("close")},async install(){this.busy=!0;const t=this.plugin;this.updateStatus(t.name,this.action);const e=t.versions?.find(t=>t.version===this.version);if(!e)return void(this.busy=!1);const i=this.chartVersionInfo?.values?.image?.repository||"",n=i.startsWith("rancher/");let s=!1;try{const e=await this.$store.dispatch("management/find",{type:v.W8.APP,id:`${m.th}/${t.chart.chartName}`,opt:{force:!0}});s=!!e}catch(h){}const a=e.repoType,l=e.repoName,o=this.$store.getters["catalog/repo"]({repoType:a,repoName:l}),r={chartName:t.chart.chartName,version:this.version,releaseName:t.chart.chartName,annotations:{[f.W8.SOURCE_REPO_TYPE]:t.repoType,[f.W8.SOURCE_REPO_NAME]:t.repoName},values:{}},u=this.defaultRegistrySetting?.value||"";n&&u&&(r.values.global=r.values.global||{},r.values.global.cattle=r.values.global.cattle||{},r.values.global.cattle.systemDefaultRegistry=u);const d={charts:[r],namespace:m.th},c=s||this.update?"upgrade":"install";try{const e=await o.doAction(c,d),i=`${e.operationNamespace}/${e.operationName}`;this.closeDialog(t),await o.waitForOperation(i),await this.$store.dispatch("management/find",{type:v.W8.OPERATION,id:i})}catch(h){this.$store.dispatch("growl/error",{title:this.t("plugins.error.generic"),message:h.message?h.message:h,timeout:1e4},{root:!0}),this.closeDialog(t)}}},watch:{version(){this.chartVersionInfo=null,this.loadVersionInfo()}}};i(66520);var x=i(66262);const k=(0,x.A)(w,[["render",h],["__scopeId","data-v-6d547632"]]),N=k},66520:(t,e,i)=>{var n=i(962);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);var s=i(99548).A;s("61a2a6e2",n,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog40.9aa596c8.js.map