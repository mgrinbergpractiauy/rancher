(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[6518],{7184:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(20641),i=s(90033);const c={class:"options"},l={class:"buttons"};function o(e,t,s,o,a,n){const u=(0,r.g2)("Banner"),d=(0,r.g2)("RadioGroup"),v=(0,r.g2)("Select"),p=(0,r.g2)("AsyncButton"),h=(0,r.g2)("Card");return(0,r.uX)(),(0,r.Wv)(h,{class:"prompt-rotate","show-highlight-border":!1,style:{height:"100%"}},{title:(0,r.k6)(()=>[(0,r.Lk)("h3",null,(0,i.v_)(e.t("cluster.rotateCertificates.modalTitle")),1)]),body:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.errors,(e,t)=>((0,r.uX)(),(0,r.Wv)(u,{key:t,class:"",color:"error",label:e},null,8,["label"]))),128)),t[4]||(t[4]=(0,r.eW)()),(0,r.Lk)("div",c,[(0,r.bF)(d,{value:a.rotateAllServices,"onUpdate:value":t[0]||(t[0]=e=>a.rotateAllServices=e),name:"service-mode",options:[{value:!0,label:e.t("cluster.rotateCertificates.allServices")},{value:!1,label:e.t("cluster.rotateCertificates.selectService")}]},null,8,["value","options"]),t[3]||(t[3]=(0,r.eW)()),(0,r.bF)(v,{value:a.selectedService,"onUpdate:value":t[1]||(t[1]=e=>a.selectedService=e),options:n.serviceOptions,class:(0,i.C4)(["service-select",{invisible:a.rotateAllServices}])},null,8,["value","options","class"])])]),actions:(0,r.k6)(()=>[(0,r.Lk)("div",l,[(0,r.Lk)("button",{class:"btn role-secondary mr-20",onClick:t[2]||(t[2]=(...e)=>n.close&&n.close(...e))},(0,i.v_)(e.t("generic.cancel")),1),t[5]||(t[5]=(0,r.eW)()),(0,r.bF)(p,{mode:"rotate",disabled:!a.rotateAllServices&&!a.selectedService,onClick:n.rotate},null,8,["disabled","onClick"])])]),_:1,__:[6,7]})}var a=s(40949),n=s(72268),u=s(14492),d=s(22516),v=s(89303),p=s(6826),h=s(37447);const f={emits:["close"],components:{Select:v.A,RadioGroup:d.z,Card:a.Z,AsyncButton:n.A,Banner:u.l},props:{cluster:{type:Object,default:()=>({})}},data(){return{selectedService:"",rotateAllServices:!0,errors:[]}},computed:{serviceOptions(){if(this.cluster.isRke2){const e=["admin","api-server","controller-manager","scheduler","cloud-controller","etcd","auth-proxy","kubelet","kube-proxy"];return this.cluster.isK3s?e.push("k3s-controller","k3s-server"):e.push("rke2-controller","rke2-server"),e.sort()}const e=this.$store.getters["rancher/schemaFor"]("rotatecertificateinput");return(0,p.get)(e,"resourceFields.services.options")||[]},actionParams(){return this.rotateAllServices?{services:this.cluster.isRke2?[]:null,caCertificates:!1}:{services:this.selectedService,caCertificates:!1}}},mounted(){this.selectedService=this.serviceOptions[0]||""},methods:{close(){this.$emit("close")},async rotate(e){const t=this.actionParams;try{if(this.cluster.isRke2){const e=this.cluster.spec?.rkeConfig?.rotateCertificates?.generation||0;(0,p.set)(this.cluster,"spec.rkeConfig.rotateCertificates",{generation:e+1,services:this.selectedService&&!this.rotateAllServices?[this.selectedService]:[]}),await this.cluster.save()}else await this.cluster.mgmt.doAction("rotateCertificates",t);e(!0),this.close()}catch(s){this.errors=(0,h.rz)(s),e(!1)}}}};s(98711);var b=s(66262);const k=(0,b.A)(f,[["render",o],["__scopeId","data-v-57fb8302"]]),m=k},97733:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(31601),i=s.n(r),c=s(76314),l=s.n(c),o=s(5111),a=l()(i());a.i(o.A),a.push([e.id,".prompt-rotate[data-v-57fb8302]{margin:0}.buttons[data-v-57fb8302]{display:flex;justify-content:flex-end;width:100%}.options[data-v-57fb8302]{display:flex;flex-direction:column}.options .service-select[data-v-57fb8302]{margin-left:20px;margin-top:10px;width:-moz-fit-content;width:fit-content;min-width:260px}",""]);const n=a},98711:(e,t,s)=>{var r=s(97733);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var i=s(99548).A;i("a3a1ccdc",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog52.6263ecaf.js.map