{"version":3,"file":"js/3629.83919482.js","mappings":"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","sources":["webpack://cluster-log-extension/./node_modules/@rancher/shell/pages/auth/verify.vue","webpack://cluster-log-extension/./node_modules/@rancher/shell/pages/auth/verify.vue?0ceb"],"sourcesContent":["<script>\nimport {\n  GITHUB_CODE, GITHUB_NONCE, BACK_TO, IS_SLO, _FLAGGED\n} from '@shell/config/query-params';\nimport { get } from '@shell/utils/object';\nimport { base64Decode } from '@shell/utils/crypto';\nimport loadPlugins from '@shell/plugins/plugin';\nimport { LOGIN_ERRORS } from '@shell/store/auth';\nimport { AUTH_BROADCAST_CHANNEL_NAME } from '@shell/utils/auth';\n\nconst samlProviders = ['ping', 'adfs', 'keycloak', 'okta', 'shibboleth'];\n\nconst oauthProviders = ['github', 'googleoauth', 'azuread'];\n\nfunction reply(err, code) {\n  try {\n    // If we have access to the opener, then use the `onAuthTest` callback\n    if (window.opener) {\n      window.opener.window.onAuthTest(err, code);\n    } else {\n      // Otherwise, use a broadcast channel\n      const bc = new BroadcastChannel(AUTH_BROADCAST_CHANNEL_NAME);\n      const msg = { err, code };\n\n      bc.postMessage(JSON.stringify(msg));\n      bc.close();\n    }\n    setTimeout(() => {\n      window.close();\n    }, 250);\n  } catch (e) {\n    console.error('Error replying to authentication verification', e); // eslint-disable-line no-console\n    window.close();\n  }\n}\n\nfunction isSaml($route) {\n  const { query } = $route;\n  const configQuery = get(query, 'config');\n\n  return samlProviders.includes(configQuery);\n}\n\nexport default {\n  async fetch() {\n    const code = this.$route.query[GITHUB_CODE];\n    const stateStr = this.$route.query[GITHUB_NONCE];\n    const {\n      error, error_description: errorDescription, errorCode, errorMsg\n    } = this.$route.query;\n\n    if (error || errorDescription || errorCode || errorMsg) {\n      let out = errorDescription || error || errorCode;\n\n      if (this.isSlo) {\n        console.error('Failed to log out of auth provider', error, errorDescription, errorCode, errorMsg); // eslint-disable-line no-console\n\n        let out = this.$store.getters['i18n/withFallback'](`logout.specificError.unknown`);\n\n        if (errorCode) {\n          out = this.$store.getters['i18n/withFallback'](`logout.specificError.${ errorCode }`, null, out);\n        }\n\n        this.$router.replace(`/auth/login?${ IS_SLO }&err=${ escape(out) }`);\n\n        return;\n      } else {\n        if (errorMsg) {\n          out = this.$store.getters['i18n/withFallback'](`login.serverError.${ errorMsg }`, null, errorMsg);\n        }\n\n        this.$router.replace(`/auth/login?err=${ escape(out) }`);\n\n        return;\n      }\n    }\n\n    // check for existence of IS_SLO query param to differentiate between a login and a logout\n    if (this.isSlo) {\n      this.$store.dispatch('auth/uiLogout');\n\n      return;\n    }\n\n    let parsed;\n\n    try {\n      parsed = JSON.parse(base64Decode((stateStr)));\n    } catch (err) {\n      if (isSaml(this.$route)) {\n        // This is an ok failure. SAML has no state string so a failure is fine (see similar check in mounted).\n        // This whole file could be re-written with that in mind, but this change keeps things simple and fixes a breaking addition\n        return;\n      }\n      const out = this.$store.getters['i18n/t'](`login.error`);\n\n      console.error('Failed to parse nonce', stateStr, err); // eslint-disable-line no-console\n\n      this.$router.replace(`/auth/login?err=${ escape(out) }`);\n\n      return;\n    }\n\n    const { test, provider, nonce } = parsed;\n\n    if (test) {\n      return;\n    }\n\n    try {\n      const res = await this.$store.dispatch('auth/verifyOAuth', {\n        code,\n        nonce,\n        provider\n      });\n\n      if ( res._status === 200) {\n        const backTo = this.$route.query[BACK_TO] || '/';\n\n        // Load plugins\n        await loadPlugins({\n          app:     this.$store.app,\n          store:   this.$store,\n          $plugin: this.$store.$plugin\n        });\n\n        this.$router.replace(backTo);\n      } else {\n        this.$router.replace(`/auth/login?err=${ escape(res) }`);\n      }\n    } catch (err) {\n      let errCode = err;\n\n      // If the provider is OAUTH, then the client error is not that the credentials are wrong, but that the user is not authorized\n      if (oauthProviders.includes(provider) && err === LOGIN_ERRORS.CLIENT_UNAUTHORIZED) {\n        errCode = LOGIN_ERRORS.USER_UNAUTHORIZED;\n      }\n\n      this.$router.replace(`/auth/login?err=${ escape(errCode) }`);\n    }\n  },\n\n  data() {\n    return {\n      testing: null,\n      isSlo:   null,\n    };\n  },\n\n  created() {\n    const stateJSON = this.$route.query[GITHUB_NONCE] || '';\n\n    let parsed = {};\n\n    try {\n      parsed = JSON.parse(base64Decode(stateJSON));\n    } catch {\n    }\n\n    const { test } = parsed;\n\n    this.testing = test;\n    this.isSlo = this.$route.query[IS_SLO] === _FLAGGED;\n  },\n\n  mounted() {\n    if ( this.testing ) {\n      try {\n        const {\n          error: respError, error_description: respErrorDescription, [GITHUB_CODE]: code, errorMsg\n        } = this.$route.query;\n\n        let error = respErrorDescription || respError || (!code ? 'No code supplied by auth provider' : null);\n\n        if (errorMsg) {\n          error = this.$store.getters['i18n/withFallback'](`login.serverError.${ errorMsg }`, null, errorMsg);\n        }\n\n        reply(error, code );\n      } catch (e) {\n        window.close();\n      }\n    } else {\n      if ( window.opener ) {\n        if (isSaml(this.$route)) {\n          if ( window.opener.window.onAuthTest ) {\n            reply(null, null);\n          } else {\n            reply({ err: 'failure' });\n          }\n        }\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <main\n    class=\"main-layout\"\n    :aria-label=\"t('layouts.verify')\"\n  >\n    <h1 class=\"text-center mt-50\">\n      <span v-if=\"testing\">\n        Testing Configuration&hellip;\n      </span>\n      <span v-else-if=\"isSlo\">\n        Logging Out&hellip;\n      </span>\n      <span v-else>\n        Logging In&hellip;\n      </span>\n    </h1>\n  </main>\n</template>\n","import { render } from \"./verify.vue?vue&type=template&id=d5bab492\"\nimport script from \"./verify.vue?vue&type=script&lang=js\"\nexport * from \"./verify.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","t","samlProviders","oauthProviders","reply","err","code","window","opener","onAuthTest","bc","BroadcastChannel","msg","postMessage","JSON","stringify","close","setTimeout","e","console","error","isSaml","$route","query","configQuery","get","includes","fetch","this","stateStr","error_description","errorDescription","errorCode","errorMsg","out","isSlo","$store","getters","$router","replace","escape","dispatch","parsed","parse","test","provider","nonce","res","_status","backTo","app","store","$plugin","errCode","LOGIN_ERRORS","CLIENT_UNAUTHORIZED","USER_UNAUTHORIZED","data","testing","created","stateJSON","mounted","respError","respErrorDescription","__exports__","render"],"ignoreList":[],"sourceRoot":""}