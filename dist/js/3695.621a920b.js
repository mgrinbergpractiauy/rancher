(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[3695],{17556:(e,t,r)=>{var a=r(43401);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=r(99548).A;s("42cbeb97",a,!0,{sourceMap:!1,shadowMode:!1})},28758:(e,t,r)=>{var a=r(35020);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=r(99548).A;s("ec5581aa",a,!0,{sourceMap:!1,shadowMode:!1})},35020:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(31601),s=r.n(a),o=r(76314),c=r.n(o),n=r(5111),i=c()(s());i.i(n.A),i.push([e.id,".invisible[data-v-6343a7f6]{display:inline-block;min-width:28px}.project-namespaces[data-v-6343a7f6]  .project-namespaces-table table{table-layout:fixed}.project-namespaces[data-v-6343a7f6]  .project-name{line-height:30px}.project-namespaces[data-v-6343a7f6]  .project-bar{display:flex;flex-direction:row;justify-content:space-between}.project-namespaces[data-v-6343a7f6]  .project-bar .group-tab{max-width:calc(100% - 230px)}.project-namespaces[data-v-6343a7f6]  .project-bar .project-name{display:flex;flex-direction:row;align-items:center}.project-namespaces[data-v-6343a7f6]  .project-bar .project-name span:first-child{padding-right:8px}.project-namespaces[data-v-6343a7f6]  .project-bar .project-name span:last-child{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.project-namespaces[data-v-6343a7f6]  .project-bar.has-description .right{margin-top:5px}.project-namespaces[data-v-6343a7f6]  .project-bar.has-description .group-tab,.project-namespaces[data-v-6343a7f6]  .project-bar.has-description .group-tab:after{height:50px}.project-namespaces[data-v-6343a7f6]  .project-bar.has-description .group-tab:after{right:-20px}.project-namespaces[data-v-6343a7f6]  .project-bar.has-description .group-tab .description{margin-top:-20px}.project-namespaces[data-v-6343a7f6]  .namespace-name{display:flex;align-items:center}.project-namespaces[data-v-6343a7f6]  .namespace-name .icon-istio{color:var(--primary)}",""]);const p=i},43401:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(31601),s=r.n(a),o=r(76314),c=r.n(o),n=r(5111),i=c()(s());i.i(n.A),i.push([e.id,".psa-tooltip{margin:3px 0;padding:0 8px 0 22px}",""]);const p=i},83695:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>H});var a=r(20641),s=r(90033);function o(e,t,r,o,c,n){const i=(0,a.g2)("ExplorerProjectsNamespaces");return(0,a.uX)(),(0,a.Wv)(i,(0,s._B)((0,a.Ng)(e.$attrs)),null,16)}const c={class:"project-namespaces outlet"},n={class:"group-tab"},i={class:"project-name"},p={key:0,class:"description text-muted text-small"},l={class:"right mr-10"},u={key:1,class:"invisible"},m={key:0},d={key:1,class:"text-muted"},h={class:"namespace-name"},j={key:1},g={key:2,class:"icon icon-istio ml-5"},b={key:3,class:"icon icon-lock ml-5"},f={class:"main-row"},v=["colspan"],P={class:"main-row"},y=["colspan"];function N(e,t,r,o,N,w){const k=(0,a.g2)("router-link"),L=(0,a.g2)("Masthead"),C=(0,a.g2)("ExtensionPanel"),A=(0,a.g2)("ActionMenu"),S=(0,a.g2)("ButtonMultiAction"),E=(0,a.g2)("ResourceTable"),$=(0,a.gN)("clean-html"),x=(0,a.gN)("trim-whitespace"),_=(0,a.gN)("clean-tooltip");return(0,a.uX)(),(0,a.CE)("div",c,[(0,a.bF)(L,{schema:N.projectSchema,"type-display":e.t("projectNamespaces.label"),resource:N.MANAGEMENT.PROJECT,"favorite-resource":N.VIRTUAL_TYPES.PROJECT_NAMESPACES,"create-location":w.createProjectLocation,"create-button-label":e.t("projectNamespaces.createProject"),"show-incremental-loading-indicator":w.showIncrementalLoadingIndicator,"load-resources":N.loadResources,"load-indeterminate":N.loadIndeterminate},(0,a.eX)({_:2},[w.showCreateNsButton?{name:"extraActions",fn:(0,a.k6)(()=>[(0,a.bF)(k,{to:w.createNamespaceLocationFlatList(),class:"btn role-primary mr-10","data-testid":"create_project_namespaces"},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.t("projectNamespaces.createNamespace")),1)]),_:1},8,["to"])]),key:"0"}:void 0]),1032,["schema","type-display","resource","favorite-resource","create-location","create-button-label","show-incremental-loading-indicator","load-resources","load-indeterminate"]),t[9]||(t[9]=(0,a.eW)()),(0,a.bF)(C,{resource:{},type:N.extensionType,location:N.extensionLocation},null,8,["type","location"]),t[10]||(t[10]=(0,a.eW)()),(0,a.bF)(E,(0,a.v6)({ref:"table"},{...e.$attrs,class:null},{class:"table project-namespaces-table",schema:N.schema,headers:w.headers,rows:w.filteredRows,"group-by":w.projectGroupBy,groupable:!0,"sort-generation-fn":w.sortGenerationFn,loading:w.loading,"group-tooltip":"resourceTable.groupBy.project","key-field":"_key"}),(0,a.eX)({"group-by":(0,a.k6)(r=>[(0,a.Lk)("div",{class:(0,s.C4)(["project-bar",{"has-description":w.projectDescription(r.group)}])},[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bo)((0,a.Lk)("div",i,null,512),[[$,w.projectLabel(r.group)]]),t[0]||(t[0]=(0,a.eW)()),w.projectDescription(r.group)?((0,a.uX)(),(0,a.CE)("div",p,(0,s.v_)(w.projectDescription(r.group)),1)):(0,a.Q3)("",!0)])),[[x]]),t[2]||(t[2]=(0,a.eW)()),(0,a.Lk)("div",l,[w.isNamespaceCreatable&&(w.canSeeProjectlessNamespaces||r.group.key!==w.notInProjectKey)?((0,a.uX)(),(0,a.Wv)(k,{key:0,class:"create-namespace btn btn-sm role-secondary mr-5",to:w.createNamespaceLocation(r.group)},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.t("projectNamespaces.createNamespace")),1)]),_:2},1032,["to"])):(0,a.Q3)("",!0),t[1]||(t[1]=(0,a.eW)()),o.featureDropdownMenu?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[w.showProjectActionButton(r.group)?((0,a.uX)(),(0,a.Wv)(A,{key:0,resource:w.getProjectActions(r.group),"data-testid":"action-button","button-aria-label":e.t("projectNamespaces.tableActionsLabel",{resource:w.projectResource(r.group)})},null,8,["resource","button-aria-label"])):((0,a.uX)(),(0,a.CE)("div",u))],64)):((0,a.uX)(),(0,a.Wv)(S,{key:2,class:"project-action",borderless:!0,"aria-label":e.t("projectNamespaces.tableActionsLabel",{resource:w.projectResource(r.group)}),invisible:!w.showProjectActionButton(r.group),onClick:e=>w.showProjectAction(e,r.group)},null,8,["aria-label","invisible","onClick"]))])],2)]),"cell:project":(0,a.k6)(({row:e})=>[e.project?((0,a.uX)(),(0,a.CE)("span",m,(0,s.v_)(e.project.nameDisplay),1)):((0,a.uX)(),(0,a.CE)("span",d,"â€“"))]),"cell:name":(0,a.k6)(({row:r})=>[(0,a.Lk)("div",h,[r.detailLocation&&!r.hideDetailLocation?((0,a.uX)(),(0,a.Wv)(k,{key:0,to:r.detailLocation},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(r.name),1)]),_:2},1032,["to"])):((0,a.uX)(),(0,a.CE)("span",j,(0,s.v_)(r.name),1)),t[3]||(t[3]=(0,a.eW)()),r.injectionEnabled?(0,a.bo)(((0,a.uX)(),(0,a.CE)("i",g,null,512)),[[_,e.t("projectNamespaces.isIstioInjectionEnabled")]]):(0,a.Q3)("",!0),t[4]||(t[4]=(0,a.eW)()),r.hasSystemLabels?(0,a.bo)(((0,a.uX)(),(0,a.CE)("i",b,null,512)),[[_,w.getPsaTooltip(r)]]):(0,a.Q3)("",!0)])]),"main-row:fake-empty":(0,a.k6)(({fullColspan:t})=>[(0,a.Lk)("tr",P,[(0,a.Lk)("td",{class:"empty text-center",colspan:t},(0,s.v_)(e.t("projectNamespaces.noProjectNoNamespaces")),9,y)])]),_:2},[(0,a.pI)(w.projectsWithoutNamespaces,(t,r)=>({name:w.slotName(t),fn:(0,a.k6)(({fullColspan:t})=>[(0,a.Lk)("tr",f,[(0,a.Lk)("td",{class:"empty text-center",colspan:t},(0,s.v_)(e.t("projectNamespaces.noNamespaces")),9,v)])])}))]),1040,["schema","headers","rows","group-by","sort-generation-fn","loading"])])}var w=r(66278),k=r(56935),L=r(31645),C=r(65843),A=r(55823),S=r(46405),E=r(25803),$=r(15340),x=r(43746),_=r(86691),F=r(71518),I=r(72140),T=r(18597),M=r(83586),R=r(99418),O=r(71883),W=r(36081),D=r(32126),U=r(88814);const X={name:"ListProjectNamespace",components:{ExtensionPanel:$.A,Masthead:x.A,ResourceTable:k.A,ButtonMultiAction:F.A,ActionMenu:D.A},mixins:[M.A],props:{createProjectLocationOverride:{type:Object,default:()=>null},createNamespaceLocationOverride:{type:Object,default:()=>null}},async fetch(){const e=this.$store.getters["currentStore"](A.CU);this.harvesterResourceQuotaSchema=this.$store.getters[`${e}/schemaFor`](A.rk.RESOURCE_QUOTA),this.schema=this.$store.getters[`${e}/schemaFor`](A.CU),this.projectSchema=this.$store.getters["management/schemaFor"](A.Mc.PROJECT),this.schema&&(await this.$fetchType(A.CU),this.projects=await this.$store.dispatch("management/findAll",{type:A.Mc.PROJECT,opt:{force:!0}}))},setup(){const e=(0,w.Pj)(),{featureDropdownMenu:t}=(0,U.K)(e);return{featureDropdownMenu:t}},data(){return{loadResources:[A.CU],loadIndeterminate:!0,harvesterResourceQuotaSchema:null,schema:null,projects:[],projectSchema:null,extensionType:E.c7.PANEL,extensionLocation:E.W7.RESOURCE_LIST,MANAGEMENT:A.Mc,VIRTUAL_TYPES:A.cG,defaultCreateProjectLocation:{name:"c-cluster-product-resource-create",params:{product:this.$store.getters["currentProduct"].name,resource:A.Mc.PROJECT}}}},watch:{actionCb:{handler(e){e?.moveNamespaceCb&&(this.clearSelection(),this.$store.dispatch("action-menu/clearCallbackData"))},immediate:!0}},computed:{...(0,w.L8)(["currentCluster","currentProduct"]),...(0,w.L8)({actionCb:"action-menu/performCallbackData"}),namespaces(){const e=this.$store.getters["currentStore"](A.CU);return this.$store.getters[`${e}/all`](A.CU)},loading(){return!(!this.currentCluster||this.namespaces.length)&&this.$fetchState.pending},showIncrementalLoadingIndicator(){return W.A.incrementalLoadingUtils.isEnabled(this.calcCanPaginate(),this.perfConfig)},isNamespaceCreatable(){return(this.schema?.collectionMethods||[]).includes("POST")},isHarvester(){return this.$store.getters["currentProduct"].inStore===O.T3},headers(){const e=[L.c4,L.o_,L.tC];if("none"===this.groupPreference){const t={name:"project",label:this.t("tableHeaders.project"),value:"project.nameDisplay",sort:["projectNameSort","nameSort"]};e.push(t)}return this.isHarvester&&this.harvesterResourceQuotaSchema&&e.push(L.Si),e.push(L.K),e},projectIdsWithNamespaces(){const e=this.rows.map(e=>e.projectId).filter(e=>e);return(0,C.sb)(e)},clusterProjects(){const e=this.currentCluster.id,t=this.$store.getters["management/all"](A.Mc.PROJECT);if(this.currentProduct?.customNamespaceFilter&&this.currentProduct?.inStore&&this.$store.getters[`${this.currentProduct.inStore}/filterProject`])return this.$store.getters[`${this.currentProduct.inStore}/filterProject`];const r=t.filter(t=>t.spec.clusterName===e);return r},projectsWithoutNamespaces(){return this.activeProjects.filter(e=>!this.projectIdsWithNamespaces.find(t=>e?.id?.endsWith(`/${t}`)))},rowsWithFakeNamespaces(){const e=this.projectsWithoutNamespaces.map(e=>({groupById:`resourceTable.groupLabel.notInAProject-${e.id}`,isFake:!0,mainRowKey:e.id,nameDisplay:e.spec?.displayName,project:e,availableActions:[]}));return this.showMockNotInProjectGroup&&e.push({groupById:this.t("resourceTable.groupLabel.notInAProject"),mainRowKey:"fake-empty"}),[...this.rows,...e]},createProjectLocation(){return this.createProjectLocationOverride||this.defaultCreateProjectLocation},groupPreference:(0,_.mapPref)(_.GROUP_RESOURCES),activeNamespaceFilters(){return this.$store.getters["activeNamespaceFilters"]},activeProjectFilters(){const e={};for(const t of this.activeNamespaceFilters){const[r,a]=t.split("://",2);"project"===r&&(e[a]=!0)}return e},activeProjects(){const e=this.$store.getters["activeNamespaceFilters"];return e.includes(T.pF)&&0===Object.keys(this.activeProjectFilters).length?[]:this.userIsFilteringForSpecificNamespaceOrProject()?this.clusterProjects.filter(e=>{const t=e.id.split("/")[1];return!!this.activeProjectFilters[t]}):this.clusterProjects},activeNamespaces(){const e=this.$store.getters["namespaces"]();return this.namespaces.filter(t=>!!e[t.metadata.name])},filteredRows(){return"none"===this.groupPreference?this.rows:this.rowsWithFakeNamespaces},rows(){let e;try{e=this.$store.getters["prefs/get"](_.ALL_NAMESPACES)}catch{e=this.$store.getters["prefs/get"](_.DEV)}return e?this.activeNamespaces:this.activeNamespaces.filter(e=>{const t=this.$store.getters["systemNamespaces"].includes(e.metadata.name),r=e.isSystem||e.isFleetManaged||t;return!this.currentProduct?.hideSystemResources||!r})},canSeeProjectlessNamespaces(){return this.currentCluster.canUpdate},showMockNotInProjectGroup(){if(!this.canSeeProjectlessNamespaces)return!1;const e=!this.rows.some(e=>!e.project),t=this.userIsFilteringForSpecificNamespaceOrProject();return!t&&e},notInProjectKey(){return this.$store.getters["i18n/t"]("resourceTable.groupLabel.notInAProject")},showCreateNsButton(){return"namespace"!==this.groupPreference},projectGroupBy(){return"none"===this.groupPreference?null:"groupById"}},methods:{getPsaTooltip(e){const t=e.psaTooltipsDescription,r=Object.values(t).sort().map(e=>`<li>${e}</li>`).join(""),a=`<p>${this.t("podSecurityAdmission.name")}: </p>`;return`${a}<ul class="psa-tooltip">${r}</ul>`},userIsFilteringForSpecificNamespaceOrProject(){const e=this.$store.getters["namespaceFilters"];for(let t=0;t<e.length;t++){const r=e[t],a=r.split("://")[0];if("ns"===a||"project"===a)return!0}return!1},slotName(e){return`main-row:${e.id}`},createNamespaceLocation(e){const t=e.rows[0].project,r=this.createNamespaceLocationOverride?{...this.createNamespaceLocationOverride}:{name:"c-cluster-product-resource-create",params:{product:this.$store.getters["currentProduct"].name,resource:A.CU}};return r.query={[S.iJ]:t?.metadata.name},r},createNamespaceLocationFlatList(){const e=this.createNamespaceLocationOverride?{...this.createNamespaceLocationOverride}:{name:"c-cluster-product-resource-create",params:{product:this.$store.getters["currentProduct"]?.name,resource:A.CU}};return e.query={[S._N]:!0},e},getProjectActions(e){return e.rows[0].project},showProjectAction(e,t){const r=t.rows[0].project;this.$store.commit("action-menu/show",{resources:[r],elem:e.target})},showProjectActionButton(e){const t=e.rows[0].project;return!!t},projectLabel(e){const t=e.rows[0];if(t.isFake)return R.A.sanitize(this.t("resourceTable.groupLabel.project",{name:t.project?.nameDisplay},!0),{ALLOWED_TAGS:["span"]});if(t.groupById===this.notInProjectKey)return this.t("resourceTable.groupLabel.notInAProject");const r=t.project?.nameDisplay||t.project?.id||"";return this.t("resourceTable.groupLabel.project",{name:(0,I.ZD)(r)},!0)},projectDescription(e){const t=e.rows[0].project;return t?.description},projectResource(e){const t=e.rows[0];return t.nameDisplay||t.id||""},clearSelection(){this.$refs.table.clearSelection()},sortGenerationFn(){const e=(0,k.S)(this.schema,this.$store);return e+(this.showMockNotInProjectGroup?"-mock":"")}}};r(28758),r(17556);var B=r(66262);const G=(0,B.A)(X,[["render",N],["__scopeId","data-v-6343a7f6"]]),K=G,Q={components:{ExplorerProjectsNamespaces:K}},J=(0,B.A)(Q,[["render",o]]),H=J}}]);
//# sourceMappingURL=3695.621a920b.js.map