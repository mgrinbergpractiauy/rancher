(self["webpackChunkcluster_log_extension"]=self["webpackChunkcluster_log_extension"]||[]).push([[9476],{37106:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>z});var s=o(20641),i=o(90033);const a={class:"text-default-text"},l={class:"pl-10 pr-10"},r={class:"buttons"},n={class:"left"},d=["disabled"],c={class:"right"};function u(e,t,o,u,h,p){const v=(0,s.g2)("Banner"),b=(0,s.g2)("LabeledSelect"),m=(0,s.g2)("YamlEditor"),f=(0,s.g2)("AsyncButton"),k=(0,s.g2)("Card");return(0,s.uX)(),(0,s.Wv)(k,{class:"prompt-rollback","show-highlight-border":!1},{title:(0,s.k6)(()=>[(0,s.Lk)("h4",a,(0,i.v_)(e.t("promptRollback.modalTitle",{workloadName:p.workloadName},!0)),1)]),body:(0,s.k6)(()=>[(0,s.Lk)("div",l,[1===h.revisions.length?((0,s.uX)(),(0,s.Wv)(v,{key:0,color:"info",label:e.t("promptRollback.singleRevisionBanner")},null,8,["label"])):(0,s.Q3)("",!0),t[4]||(t[4]=(0,s.eW)()),(0,s.Lk)("form",null,[(0,s.bF)(b,{value:h.selectedRevision,"onUpdate:value":t[0]||(t[0]=e=>h.selectedRevision=e),class:"provider",label:e.t("promptRollback.dropdownTitle"),placeholder:e.t("promptRollback.placeholder"),options:h.revisions,"get-option-label":p.getOptionLabel},null,8,["value","label","placeholder","options","get-option-label"])]),t[5]||(t[5]=(0,s.eW)()),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.errors,(e,t)=>((0,s.uX)(),(0,s.Wv)(v,{key:t,class:"",color:"error",label:e},null,8,["label"]))),128)),t[6]||(t[6]=(0,s.eW)()),h.selectedRevision&&h.showDiff?((0,s.uX)(),(0,s.Wv)(m,{key:p.selectedRevisionId,value:p.sanitizedSelectedRevision,"onUpdate:value":t[1]||(t[1]=e=>p.sanitizedSelectedRevision=e),"initial-yaml-values":p.sanitizeYaml(h.currentRevision),class:"mt-10","editor-mode":h.editorMode,"as-object":!0},null,8,["value","initial-yaml-values","editor-mode"])):(0,s.Q3)("",!0)])]),actions:(0,s.k6)(()=>[(0,s.Lk)("div",r,[(0,s.Lk)("div",n,[(0,s.Lk)("button",{disabled:!h.selectedRevision,class:"btn role-secondary diff",onClick:t[2]||(t[2]=e=>{h.showDiff=!h.showDiff,p.sizeDialog()})},(0,i.v_)(h.showDiff?e.t("resourceYaml.buttons.hideDiff"):e.t("resourceYaml.buttons.diff")),9,d)]),t[8]||(t[8]=(0,s.eW)()),(0,s.Lk)("div",c,[(0,s.Lk)("button",{class:"btn role-secondary mr-10",onClick:t[3]||(t[3]=(...e)=>p.close&&p.close(...e))},(0,i.v_)(e.t("generic.cancel")),1),t[7]||(t[7]=(0,s.eW)()),(0,s.bF)(f,{"action-label":e.t("asyncButton.rollback.action"),disabled:!h.selectedRevision,"get-option-label":"getOptionLabel","right-align":!0,onClick:p.save},null,8,["action-label","disabled","onClick"])])])]),_:1,__:[9,10]})}var h=o(72268),p=o(74353),v=o.n(p),b=o(40949),m=o(37447),f=o(85158),k=o(14492),g=o(43556),y=o(55823),R=o(75289),w=o(66278),L=o(57561),C=o(86691),_=o(72140);const A=["metadata.labels.pod-template-hash","spec.selector.matchLabels.pod-template-hash","spec.template.metadata.labels.pod-template-hash","metadata.fields"],N=[...L.t6,...L.Ng,...A],D=N.reduce((e,t)=>(e[t]=!0,e),{}),x={emits:["close"],components:{Card:b.Z,AsyncButton:h.A,LabeledSelect:f.A,Banner:k.l,YamlEditor:g.A},props:{workload:{type:Object,required:!0}},data(){return{errors:[],selectedRevision:null,currentRevision:null,revisions:[],editorMode:g.j.DIFF_CODE,showDiff:!1}},computed:{...(0,w.L8)({t:"i18n/t"}),...(0,w.L8)(["currentCluster"]),workloadName(){return this.workload.metadata.name},workloadNamespace(){return this.workload.metadata.namespace},workloadType(){return this.workload.kind.toLowerCase()},revisionsType(){return"deployment"===this.workloadType?y.oU.REPLICA_SET:"apps.controllerrevision"},selectedRevisionId(){return this.selectedRevision.id},sanitizedSelectedRevision(){return this.sanitizeYaml(this.selectedRevision)},timeFormatStr(){const e=(0,_.ZD)(this.$store.getters["prefs/get"](C.DATE_FORMAT)),t=(0,_.ZD)(this.$store.getters["prefs/get"](C.TIME_FORMAT));return`${e}, ${t}`}},fetch(){this.$store.dispatch("cluster/findAll",{type:this.revisionsType}).then(e=>{const t=e,o=e=>{const t=e.metadata.relationships,o=t.filter(e=>{const t=e.fromId&&e.fromId===`${this.workloadNamespace}/${this.workloadName}`;return t});return o.length>0},s=t.filter(e=>o(e)),i=s.map(e=>(this.isCurrentRevision(e)&&(this.currentRevision=e),this.buildRevisionOption(e))).sort((e,t)=>t.revisionNumber-e.revisionNumber);this.revisions=i}).catch(e=>{this.errors=(0,m.rz)(e)})},methods:{close(){this.$emit("close")},async save(){try{await this.workload.rollBack(this.currentCluster,this.workload,this.selectedRevision),this.close()}catch(e){this.errors=(0,m.rz)(e)}},isCurrentRevision(e){return e.revisionNumber===this.workload.currentRevisionNumber},buildRevisionOption(e){const{revisionNumber:t}=e,o=this.isCurrentRevision(e),s=v()(),i=v()(e.metadata.creationTimestamp),a=i.format(this.timeFormatStr),l=(0,R.qx)(i,s,this.t),r=`${a}, ${l.label}`,n=this.t(l.unitsKey,{count:l.label}),d=this.t("promptRollback.currentLabel"),c=this.t("promptRollback.revisionOption",{revisionNumber:t,revisionAge:r,units:n,currentLabel:o?d:""});return{label:c,value:e,disabled:o,revisionNumber:t}},getOptionLabel(e){return e.label},sizeDialog(){const e=document.getElementsByClassName("modal-container"),t=this.showDiff?"85%":"600px";1===e.length&&e[0].style.setProperty("width",t)},sanitizeYaml(e,t=""){const o={};return e?(Object.keys(e).forEach(s=>{const i=t?`${t}.${s}`:s;D[i]||(o[s]=e[s],"object"!==typeof e[s]||Array.isArray(e[s])||(o[s]=this.sanitizeYaml(e[s],i)))}),o):e}}};o(98771);var T=o(66262);const $=(0,T.A)(x,[["render",u],["__scopeId","data-v-b2f91780"]]),z=$},91897:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});var s=o(31601),i=o.n(s),a=o(76314),l=o.n(a),r=o(5111),n=l()(i());n.i(r.A),n.push([e.id,".prompt-rollback[data-v-b2f91780]{margin:0}.prompt-rollback[data-v-b2f91780]  .card-actions{display:grid}.yaml-editor[data-v-b2f91780]{max-height:70vh}.yaml-editor[data-v-b2f91780] .root{max-height:65vh}.diff[data-v-b2f91780]:disabled{border:none}.diff[data-v-b2f91780]:focus{background:transparent;box-shadow:none}[data-v-b2f91780]  .card-body{max-height:calc(95vh - 135px);overflow:hidden}",""]);const d=n},98771:(e,t,o)=>{var s=o(91897);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var i=o(99548).A;i("72d6ce78",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog50.d6cce631.js.map