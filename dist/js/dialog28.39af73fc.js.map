{"version":3,"file":"js/dialog28.39af73fc.js","mappings":"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","sources":["webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/FeatureFlagListDialog.vue?56d4","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/FeatureFlagListDialog.vue","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/FeatureFlagListDialog.vue?afe2","webpack://cluster-log-extension/./node_modules/@rancher/shell/dialog/FeatureFlagListDialog.vue?c8bd"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../../cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../vue-loader/dist/index.js??ruleSet[0].use[1]!./FeatureFlagListDialog.vue?vue&type=style&index=0&id=5baecfdb&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"4a5721cb\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","\n<script>\nimport { mapGetters } from 'vuex';\n\nimport { Card } from '@components/Card';\nimport { Banner } from '@components/Banner';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport AsyncButton from '@shell/components/AsyncButton';\n\nimport { MANAGEMENT } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport { getVendor } from '@shell/config/private-label';\n\nexport default {\n  name: 'FeatureFlagListDialog',\n\n  emits: ['close'],\n\n  components: {\n    Card, Banner, LabeledInput, AsyncButton\n  },\n\n  props: {\n    resources: {\n      type:    Array,\n      default: () => []\n    },\n    registerBackgroundClosing: {\n      type:    Function,\n      default: () => {}\n    }\n  },\n\n  async fetch() {\n    // Only support updating one at a time - bulk does not make sense, as they may\n    // be in different states and with different restart values\n    this.update = this.resources[0];\n\n    if (this.update) {\n      this.restart = this.update.restartRequired;\n      // If the value is currently false, then we will be enabling it\n      this.enabling = !this.update.enabled;\n      this.updateMode = this.enabling ? 'activate' : 'deactivate';\n    }\n\n    this.serverUrlSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.SERVER_URL);\n\n    if (this.serverUrlSetting?.value) {\n      this.serverUrl = this.serverUrlSetting.value;\n    } else {\n      this.noUrlSet = true;\n      this.serverUrl = window.location.origin;\n    }\n  },\n\n  data() {\n    return {\n      update:           [],\n      updateMode:       'activate',\n      error:            null,\n      enabling:         false,\n      restart:          false,\n      waiting:          false,\n      timer:            null,\n      serverUrlSetting: {},\n      serverUrl:        '',\n      noUrlSet:         false,\n      vendor:           getVendor(),\n    };\n  },\n\n  computed: {\n    ...mapGetters({ t: 'i18n/t' }),\n\n    promptForUrl() {\n      return this.update?.id === 'multi-cluster-management' && this.noUrlSet;\n    }\n  },\n\n  methods: {\n    close() {\n      if (this.timer) {\n        clearTimeout(this.timer);\n        this.timer = null;\n      }\n\n      this.$emit('close');\n    },\n\n    toggleFlag(btnCB) {\n      if (this.restart) {\n        this.doToggleWithRestart(btnCB);\n      } else {\n        this.doToggle(btnCB);\n      }\n    },\n\n    async doToggle(btnCB) {\n      this.error = null;\n      try {\n        this.update.spec.value = !this.update.enabled;\n        await this.update.save();\n        btnCB(true);\n        this.close();\n      } catch (err) {\n        // An error occurred, so toggle back the value - the call failed, so the change was not made\n        this.update.spec.value = !this.update.enabled;\n        this.error = err.message || err;\n        btnCB(false);\n      }\n    },\n\n    doToggleWithRestart(btnCB) {\n      this.error = null;\n      try {\n        this.update.spec.value = !this.update.enabled;\n        // await can go back in when backend returns from the save before restarting\n        this.update.save();\n      } catch (err) {}\n\n      this.waitForBackend(btnCB, this.update.id);\n      this.waiting = true;\n    },\n\n    waitForBackend(btnCB, id) {\n      const url = `/v3/features/${ id }`;\n\n      this.timer = setTimeout(async() => {\n        try {\n          const response = await this.$axios.get(url, { timeout: 5000 });\n\n          if (response?.status === 200) {\n            btnCB(true);\n            this.waiting = false;\n            this.close();\n\n            await this.$store.dispatch('management/findAll', { type: this.resource, opt: { force: true } });\n          }\n        } catch (e) {}\n\n        if (this.waiting) {\n          this.waitForBackend(btnCB, id);\n        }\n      }, 5000);\n    },\n\n    async saveUrl(btnCB) {\n      try {\n        this.serverUrlSetting.value = this.serverUrl;\n        await this.serverUrlSetting.save();\n        btnCB(true);\n      } catch (err) {\n        this.error = err;\n        btnCB(false);\n      }\n    },\n  }\n};\n</script>\n\n<template>\n  <Card\n    v-if=\"!waiting\"\n    class=\"prompt-update\"\n    :show-highlight-border=\"false\"\n  >\n    <template #title>\n      <h4 class=\"text-default-text\">\n        {{ t('featureFlags.title') }}\n      </h4>\n    </template>\n    <template #body>\n      <div\n        v-if=\"update\"\n        class=\"mb-10\"\n      >\n        <div v-if=\"enabling\">\n          <span>\n            {{ t('featureFlags.promptActivate', {flag: update.id}) }}\n          </span>\n          <div\n            v-if=\"promptForUrl\"\n            class=\"mt-10\"\n          >\n            <span> {{ t('featureFlags.requiresSetting') }}</span>\n            <div\n              :style=\"{'align-items':'center'}\"\n              class=\"row mt-10\"\n            >\n              <LabeledInput\n                v-model:value=\"serverUrl\"\n                :label=\"t('setup.serverUrl.label')\"\n              />\n              <div class=\"col pl-5\">\n                <AsyncButton @click=\"saveUrl\" />\n              </div>\n            </div>\n          </div>\n        </div>\n        <span v-else>\n          {{ t('featureFlags.promptDeactivate', {flag: update.id}) }}\n        </span>\n        <Banner\n          v-if=\"restart\"\n          color=\"error\"\n          :label=\"t('featureFlags.restartRequired', vendor)\"\n        />\n      </div>\n      <div class=\"text-error mb-10\">\n        {{ error }}\n      </div>\n    </template>\n    <template #actions>\n      <button\n        class=\"btn role-secondary\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n      <AsyncButton\n        :disabled=\"promptForUrl && !serverUrlSetting.value\"\n        :mode=\"updateMode\"\n        class=\"btn bg-error ml-10\"\n        @click=\"toggleFlag\"\n      />\n    </template>\n  </Card>\n  <Card\n    v-else\n    class=\"prompt-update\"\n    :show-highlight-border=\"false\"\n  >\n    <template #title>\n      <h4 class=\"text-default-text\">\n        {{ t('featureFlags.restart.title') }}\n      </h4>\n    </template>\n    <template #body>\n      <div class=\"waiting\">\n        <p>{{ t('featureFlags.restart.wait') }}</p>\n        <span class=\"restarting-icon\">\n          <i class=\" icon icon-spinner icon-spin\" />\n        </span>\n      </div>\n    </template>\n    <template #actions>\n      <button\n        class=\"btn role-secondary\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n    </template>\n  </Card>\n</template>\n\n<style lang=\"scss\" scoped>\n.prompt-update {\n  &.card-container {\n    box-shadow: none;\n  }\n\n  :deep() .card-actions {\n    display: flex;\n    justify-content: center;\n  }\n\n  .waiting {\n    text-align: center;\n    font-size: 14px;\n    margin: 10px 0;\n\n    p {\n      line-height: 20px;;\n    }\n  }\n\n  .restarting-icon {\n    display: flex;\n    justify-content: center;\n    margin-top: 10px;\n\n    > I {\n    font-size: 24px;\n    }\n  }\n}\n</style>\n","import { render } from \"./FeatureFlagListDialog.vue?vue&type=template&id=5baecfdb&scoped=true\"\nimport script from \"./FeatureFlagListDialog.vue?vue&type=script&lang=js\"\nexport * from \"./FeatureFlagListDialog.vue?vue&type=script&lang=js\"\n\nimport \"./FeatureFlagListDialog.vue?vue&type=style&index=0&id=5baecfdb&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-5baecfdb\"]])\n\nexport default __exports__","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../xterm/css/xterm.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.prompt-update.card-container[data-v-5baecfdb]{box-shadow:none}.prompt-update[data-v-5baecfdb]  .card-actions{display:flex;justify-content:center}.prompt-update .waiting[data-v-5baecfdb]{text-align:center;font-size:14px;margin:10px 0}.prompt-update .waiting p[data-v-5baecfdb]{line-height:20px}.prompt-update .restarting-icon[data-v-5baecfdb]{display:flex;justify-content:center;margin-top:10px}.prompt-update .restarting-icon>I[data-v-5baecfdb]{font-size:24px}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["content","__esModule","default","module","id","locals","exports","add","class","style","waiting","title","t","body","actions","close","flag","update","value","serverUrl","label","saveUrl","color","vendor","error","disabled","promptForUrl","serverUrlSetting","mode","updateMode","toggleFlag","name","emits","components","Card","Banner","LabeledInput","AsyncButton","props","resources","type","Array","registerBackgroundClosing","Function","fetch","this","restart","restartRequired","enabling","enabled","$store","getters","SETTING","SERVER_URL","noUrlSet","window","location","origin","data","timer","computed","methods","clearTimeout","$emit","btnCB","doToggleWithRestart","doToggle","spec","save","err","message","waitForBackend","url","setTimeout","async","response","$axios","get","timeout","status","dispatch","resource","opt","force","e","__exports__","render","___CSS_LOADER_EXPORT___","i","push"],"ignoreList":[],"sourceRoot":""}