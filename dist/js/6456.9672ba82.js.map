{"version":3,"file":"js/6456.9672ba82.js","mappings":"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","sources":["webpack://cluster-log-extension/./node_modules/@rancher/shell/mixins/brand.js","webpack://cluster-log-extension/./node_modules/@rancher/shell/components/templates/blank.vue","webpack://cluster-log-extension/./node_modules/@rancher/shell/components/templates/blank.vue?3338","webpack://cluster-log-extension/./node_modules/@rancher/shell/utils/cspAdaptor.ts","webpack://cluster-log-extension/./node_modules/@rancher/shell/utils/favicon.js"],"sourcesContent":["import { mapGetters } from 'vuex';\nimport { MANAGEMENT } from '@shell/config/types';\nimport { SETTING } from '@shell/config/settings';\nimport { createCssVars } from '@shell/utils/color';\nimport { setTitle } from '@shell/config/private-label';\nimport { setFavIcon, haveSetFavIcon } from '@shell/utils/favicon';\nimport { allHash } from '@shell/utils/promise';\nimport { fetchInitialSettings } from '@shell/utils/settings';\nimport CspAdapterUtils from '@shell/utils/cspAdaptor';\n\nexport default {\n  async fetch() {\n    try {\n      const res = await allHash({\n        // Ensure we read the settings even when we are not authenticated\n        globalSettings: fetchInitialSettings(this.$store),\n        apps:           CspAdapterUtils.fetchCspAdaptorApp(this.$store),\n      });\n\n      // The favicon is implicitly dependent on the initial settings having already been fetched\n      if (!haveSetFavIcon()) {\n        setFavIcon(this.$store);\n      }\n\n      this.apps = res.apps;\n    } catch (e) { }\n\n    // Setting this up front will remove `computed` churn, and we only care that we've initialised them\n    this.haveAppsAndSettings = !!this.apps && !!this.globalSettings;\n  },\n\n  data() {\n    return {\n      apps: null, haveAppsAndSettings: null, canPaginate: false\n    };\n  },\n\n  computed: {\n    ...mapGetters({ loggedIn: 'auth/loggedIn' }),\n\n    // added to fix https://github.com/rancher/dashboard/issues/10788\n    // because on logout the brand mixin is mounted, but then a management store reset happens\n    // since login view get loaded, another fetchInitialSettings get's done\n    // which in turn will populate again globalSettings\n    globalSettings() {\n      return this.$store.getters['management/all'](MANAGEMENT.SETTING);\n    },\n\n    brand() {\n      const setting = this.globalSettings?.find((gs) => gs.id === SETTING.BRAND);\n\n      return setting?.value;\n    },\n\n    color() {\n      const setting = this.globalSettings?.find((gs) => gs.id === SETTING.PRIMARY_COLOR);\n\n      return setting?.value;\n    },\n\n    linkColor() {\n      const setting = this.globalSettings?.find((gs) => gs.id === SETTING.LINK_COLOR);\n\n      return setting?.value;\n    },\n\n    theme() {\n      const setting = this.globalSettings?.find((gs) => gs.id === SETTING.THEME);\n\n      // This handles cases where the settings update after the page loads (like on log out)\n      if (setting?.value) {\n        return setting?.value;\n      }\n\n      return this.$store.getters['prefs/theme'];\n    },\n\n    cspAdapter() {\n      if (!this.canCalcCspAdapter) {\n        // We only have a watch on cspAdapter to kick off persisting the brand setting.\n        // So we need to ensure we don't return an undefined here... which would match the undefined gave if no csp app was found...\n        // .. and wouldn't kick off the watcher\n        return '';\n      }\n\n      // Note! this used to be `findBy(this.app)` however for that case we lost reactivity on the collection\n      // (computed fires before fetch, fetch happens and update apps, computed would not fire again - even with vue.set)\n      // So use `.find` in method instead\n      return CspAdapterUtils.hasCspAdapter({ $store: this.$store, apps: this.apps });\n    },\n\n    canCalcCspAdapter() {\n      // We need to take consider the loggedIn state, as the brand mixin is used in the logout page where we can be in a mixed state\n      // (things in store but user has no auth to make changes)\n      return this.loggedIn && this.haveAppsAndSettings;\n    }\n  },\n\n  watch: {\n    color: {\n      handler(neu) {\n        if (neu) {\n          this.setCustomColor(neu);\n        } else {\n          this.removeCustomColor();\n        }\n      },\n      immediate: true\n    },\n    linkColor: {\n      handler(neu) {\n        if (neu) {\n          this.setCustomColor(neu, 'link');\n        } else {\n          this.removeCustomColor('link');\n        }\n      },\n      immediate: true\n    },\n    theme: {\n      handler() {\n        if (this.color) {\n          this.setCustomColor(this.color);\n        }\n        if (this.linkColor) {\n          this.setCustomColor(this.linkColor, 'link');\n        }\n        this.setBodyClass();\n      },\n      immediate: true\n    },\n\n    cspAdapter: {\n      handler(neu) {\n        if (!this.canCalcCspAdapter) {\n          return;\n        }\n\n        // The brand setting will only get updated if...\n        if (neu && !this.brand) {\n          // 1) There should be a brand... but there's no brand setting\n          const brandSetting = this.globalSettings?.find((gs) => gs.id === SETTING.BRAND);\n\n          if (brandSetting) {\n            brandSetting.value = 'csp';\n            brandSetting.save();\n          } else {\n            const schema = this.$store.getters['management/schemaFor'](MANAGEMENT.SETTING);\n            const url = schema?.linkFor('collection');\n\n            if (url) {\n              this.$store.dispatch('management/create', {\n                type: MANAGEMENT.SETTING, metadata: { name: SETTING.BRAND }, value: 'csp', default: ''\n              }).then((setting) => setting.save());\n            }\n          }\n        }\n      },\n      immediate: true\n    },\n    brand: {\n      handler() {\n        this.setBodyClass();\n      },\n      immediate: true\n    }\n\n  },\n  mounted() {\n    this.setBodyClass();\n    setTitle();\n  },\n  methods: {\n    setCustomColor(color, name = 'primary') {\n      const vars = createCssVars(color, this.theme, name);\n\n      for (const prop in vars) {\n        document.body.style.setProperty(prop, vars[prop]);\n      }\n    },\n\n    removeCustomColor(name = 'primary') {\n      const vars = createCssVars('rgb(0,0,0)', this.theme, name);\n\n      for (const prop in vars) {\n        document.body.style.removeProperty(prop);\n      }\n    },\n    setBodyClass() {\n      const body = document.getElementsByTagName('body')[0];\n      const cssClass = `overflow-hidden dashboard-body`;\n      let bodyClass = `theme-${ this.theme } ${ cssClass }`;\n\n      if ( this.brand ) {\n        try {\n          const brandMeta = require(`~shell/assets/brand/${ this.brand }/metadata.json`);\n\n          if (brandMeta?.hasStylesheet === 'true') {\n            bodyClass = `${ cssClass } ${ this.brand } theme-${ this.theme }`;\n          } else {\n            bodyClass = `theme-${ this.theme } overflow-hidden dashboard-body`;\n            this.$store.dispatch('prefs/setBrandStyle', this.theme === 'dark');\n          }\n        } catch {}\n      }\n      body.className = bodyClass;\n    }\n  }\n\n};\n","<script>\nimport Brand from '@shell/mixins/brand';\nimport Inactivity from '@shell/components/Inactivity';\n\nexport default {\n  components: { Inactivity },\n  mixins:     [Brand],\n};\n</script>\n\n<template>\n  <main\n    class=\"main-layout\"\n    :aria-label=\"t('layouts.blank')\"\n  >\n    <router-view :key=\"$route.path\" />\n\n    <Inactivity />\n  </main>\n</template>\n\n<style lang=\"scss\" scoped>\n</style>\n","import { render } from \"./blank.vue?vue&type=template&id=326f70f2\"\nimport script from \"./blank.vue?vue&type=script&lang=js\"\nexport * from \"./blank.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","// For testing these could be changed to something like...\n\nimport { CATALOG } from '@shell/config/types';\nimport { FilterArgs, PaginationFilterField, PaginationParamFilter } from '@shell/types/store/pagination.types';\nimport { VuexStore } from '@shell/types/store/vuex';\n\nconst CSP_ADAPTER_APPS = ['rancher-csp-adapter', 'rancher-csp-billing-adapter'];\n// For testing above line could be replaced with below line...\n// const cspAdaptorApp = ['rancher-webhooka', 'rancher-webhook'];\n\n/**\n * Helpers in order to\n */\nclass CspAdapterUtils {\n  static canPagination($store: VuexStore): boolean {\n    return $store.getters[`management/paginationEnabled`]({ id: CATALOG.APP, context: 'branding' });\n  }\n\n  static fetchCspAdaptorApp($store: VuexStore): Promise<any> {\n    // For the login page, the schemas won't be loaded - we don't need the apps in this case\n    if ($store.getters['management/canList'](CATALOG.APP)) {\n      if (CspAdapterUtils.canPagination($store)) {\n        // Restrict the amount of apps we need to fetch\n        return $store.dispatch('management/findPage', {\n          type: CATALOG.APP,\n          opt:  { // Of type ActionFindPageArgs\n            pagination: new FilterArgs({\n              filters: PaginationParamFilter.createMultipleFields(CSP_ADAPTER_APPS.map(\n                (t) => new PaginationFilterField({\n                  field: 'metadata.name',\n                  value: t,\n                })\n              )),\n            })\n          }\n        });\n      }\n\n      return $store.dispatch('management/findAll', { type: CATALOG.APP });\n    }\n\n    return Promise.resolve([]);\n  }\n\n  static hasCspAdapter({ $store, apps }: { $store: VuexStore, apps: any[]}): Object {\n    // In theory this should contain the filtered apps when pagination is on, and all apps when off. Keep filtering though in both cases just in case\n    return apps?.find((a) => CSP_ADAPTER_APPS.includes(a.metadata?.name));\n  }\n}\n\nexport default CspAdapterUtils;\n","import { SETTING } from '@shell/config/settings';\nimport { MANAGEMENT } from '@shell/config/types';\n\nlet favIconSet = false;\n\nexport function haveSetFavIcon() {\n  return favIconSet;\n}\n\nexport function setFavIcon(store) {\n  const res = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.FAVICON);\n  const brandSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.BRAND);\n  const link = findIconLink(document.head.getElementsByTagName('link'));\n\n  if (link) {\n    let brandImage;\n\n    if (brandSetting?.value === 'suse') {\n      brandImage = require('~shell/assets/brand/suse/favicon.png');\n    } else if (brandSetting?.value === 'csp') {\n      brandImage = require('~shell/assets/brand/csp/favicon.png');\n    } else if (brandSetting?.value === 'harvester') {\n      brandImage = require('~shell/assets/brand/harvester/favicon.png');\n    }\n\n    link.href = res?.value || brandImage || defaultFavIcon;\n    favIconSet = true;\n  }\n}\n\nfunction getCurrentFavIcon() {\n  const link = findIconLink(document.head.getElementsByTagName('link'));\n\n  return link ? link.href : '';\n}\n\nfunction findIconLink(links) {\n  for (let i = 0; i < links.length; i++) {\n    const link = links[i];\n\n    if (link.rel?.includes('icon')) {\n      return link;\n    }\n  }\n\n  return undefined;\n}\n\nconst defaultFavIcon = getCurrentFavIcon();\n"],"names":["fetch","res","globalSettings","this","$store","apps","fetchCspAdaptorApp","e","haveAppsAndSettings","data","canPaginate","computed","loggedIn","getters","SETTING","brand","setting","find","gs","id","BRAND","value","color","PRIMARY_COLOR","linkColor","LINK_COLOR","theme","THEME","cspAdapter","canCalcCspAdapter","hasCspAdapter","watch","handler","neu","setCustomColor","removeCustomColor","immediate","setBodyClass","brandSetting","save","schema","url","linkFor","dispatch","type","metadata","name","default","then","mounted","methods","vars","prop","document","body","style","setProperty","removeProperty","getElementsByTagName","cssClass","bodyClass","brandMeta","hasStylesheet","className","class","t","key","$route","path","components","Inactivity","mixins","__exports__","render","CSP_ADAPTER_APPS","CspAdapterUtils","canPagination","APP","context","opt","pagination","filters","createMultipleFields","map","field","Promise","resolve","a","includes","favIconSet","haveSetFavIcon","setFavIcon","store","FAVICON","link","findIconLink","head","brandImage","href","defaultFavIcon","getCurrentFavIcon","links","i","length","rel"],"ignoreList":[],"sourceRoot":""}