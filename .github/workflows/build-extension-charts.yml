# Reemplaza el bloque 'Reorganize Extension and Chart Folders (FIX)' con este:
      - name: Reorganize Extension and Chart Folders (FINAL FIX)
        run: |
          echo "--- Reorganizando Extensión (./pkg/cluster-log-extension) ---"
          mkdir -p extensions
          if [ -d "./pkg/cluster-log-extension" ]; then
            mv ./pkg/cluster-log-extension ./extensions/
            echo "Extensión movida correctamente a ./extensions/."
          else
            echo "ERROR: Directorio ./pkg/cluster-log-extension no encontrado. El código fuente debe estar presente."
            exit 1 # Forzamos la falla si no encuentra el código fuente
          fi

          echo "--- Reorganizando Chart (./chart o ./Chart.yaml) ---"
          mkdir -p charts/cluster-log-extension
          
          # Prioridad 1: Buscar en la carpeta 'chart' (singular)
          if [ -d "./chart" ]; then
            mv ./chart/* ./charts/cluster-log-extension/
            echo "Chart movido de la carpeta ./chart a la carpeta de destino."
          
          # Prioridad 2: Buscar archivos del chart en la raíz del repositorio
          elif [ -f "./Chart.yaml" ]; then
            echo "Detectado Chart.yaml en la raíz. Moviendo archivos del chart desde la raíz..."
            mv ./Chart.yaml ./charts/cluster-log-extension/
            # Mueve otros archivos comunes del chart, ignorando errores si no existen (2>/dev/null || true)
            mv ./values.yaml ./charts/cluster-log-extension/ 2>/dev/null || true
            if [ -d "./templates" ]; then
              mv ./templates ./charts/cluster-log-extension/
            fi
            echo "Archivos del Chart movidos de la raíz a ./charts/cluster-log-extension/."
          else
            echo "ERROR: No se encontró la carpeta 'chart' ni 'Chart.yaml' en la raíz. El Chart debe estar en una de estas ubicaciones."
            exit 1 # Forzamos la falla si no encuentra el Chart
          fi
          
          echo "--- Estructura de carpetas final (previo a yarn) ---"
          ls -R
